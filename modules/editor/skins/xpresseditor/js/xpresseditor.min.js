function editorStart_xe(a,b,c,d,e,f,g,h){function i(){try{var a,b=q.contentWindow.document;if("about:blank"==b.location)throw"blank";b.body.innerHTML=b.body.innerHTML.trim(),a=b.body.innerHTML,p.registerPlugin(new xe.XE_EditingArea_WYSIWYG(q)),p.registerPlugin(new xe.XpressRangeManager(q)),p.registerPlugin(new xe.XE_ExecCommand(q)),g&&!b.body.style.fontFamily&&(b.body.style.fontFamily=g),h&&!b.body.style.fontSize&&(b.body.style.fontSize=h),p.run()}catch(c){setTimeout(i,0)}}"undefined"==typeof e&&(e="white"),"undefined"==typeof f&&(f="xeStyle"),"undefined"==typeof g&&(g=""),"undefined"==typeof h&&(h="");var j=request_uri+"modules/editor/styles/"+f+"/editor.html",k=jQuery("#xpress-editor-"+a),l=jQuery('<iframe id="editor_iframe_'+a+'" allowTransparency="true" frameborder="0" src="'+j+'" scrolling="yes" style="width:100%;height:'+d+'px"></iframe>'),m=jQuery('<textarea rows="8" cols="42" class="input_syntax '+e+'" style="display:none"></textarea>'),n=k.get(0).form;n.setAttribute("editor_sequence",a),k.css("display","none");var o="";jQuery("input[name=content]",n).size()>0&&(o=jQuery("input[name=content]",n).val().replace(/src=\"files\/attach/g,'src="'+request_uri+"files/attach"),jQuery("#xpress-editor-"+a).val(o)),k.hide().css("width","100%").before(l).after(m);var p=new xe.XpressCore,q=l.get(0),r=k.get(0),t=m.get(0),u=jQuery(".xpress-editor",n).get(0);p.getFrame=function(){return q},p.getContent=function(){editorGetContentTextarea_xe(a)};var v=n[c].value;return xFF&&!v&&(v="<br />"),v=editorReplacePath(v),n[c].value=v,jQuery("#xpress-editor-"+a).val(v),editorRelKeys[a]=new Array,editorRelKeys[a].primary=n[b],editorRelKeys[a].content=n[c],editorRelKeys[a].func=editorGetContentTextarea_xe,editorRelKeys[a].editor=p,editorRelKeys[a].pasteHTML=function(a){p.exec("PASTE_HTML",[a])},xe.Editors[a]=p,p.registerPlugin(new xe.CorePlugin(null)),p.registerPlugin(new xe.XE_PreservTemplate(jQuery("#xpress-editor-"+a).val())),p.registerPlugin(new xe.StringConverterManager),p.registerPlugin(new xe.XE_EditingAreaManager("WYSIWYG",r,{nHeight:parseInt(d),nMinHeight:100},null,u)),p.registerPlugin(new xe.XE_EditingArea_HTMLSrc(t)),p.registerPlugin(new xe.XE_EditingAreaVerticalResizer(u)),p.registerPlugin(new xe.Utils),p.registerPlugin(new xe.DialogLayerManager),p.registerPlugin(new xe.ActiveLayerManager),p.registerPlugin(new xe.Hotkey),p.registerPlugin(new xe.XE_WYSIWYGStyler),p.registerPlugin(new xe.XE_WYSIWYGStyleGetter),p.registerPlugin(new xe.MessageManager(xe.XpressCore.oMessageMap)),p.registerPlugin(new xe.XE_Toolbar(u)),p.registerPlugin(new xe.XE_XHTMLFormatter),p.registerPlugin(new xe.XE_GET_WYSYWYG_MODE(a)),jQuery("ul.extra1").length&&(p.registerPlugin(new xe.XE_ColorPalette(u)),p.registerPlugin(new xe.XE_FontColor(u)),p.registerPlugin(new xe.XE_BGColor(u)),p.registerPlugin(new xe.XE_Quote(u)),p.registerPlugin(new xe.XE_FontNameWithSelectUI(u)),p.registerPlugin(new xe.XE_FontSizeWithSelectUI(u)),p.registerPlugin(new xe.XE_LineHeightWithSelectUI(u)),p.registerPlugin(new xe.XE_UndoRedo),p.registerPlugin(new xe.XE_Table(u)),p.registerPlugin(new xe.XE_Hyperlink(u)),p.registerPlugin(new xe.XE_FormatWithSelectUI(u)),p.registerPlugin(new xe.XE_SCharacter(u))),jQuery("ul.extra2").length&&p.registerPlugin(new xe.XE_Extension(u,a)),jQuery("ul.extra3").length&&p.registerPlugin(new xe.XE_EditingModeToggler(u)),jQuery("#editorresize").length&&p.registerPlugin(new xe.XE_Editorresize(u,q)),jQuery.browser.msie||jQuery.browser.opera||p.registerPlugin(new xe.XE_WYSIWYGEnterKey(q)),(s=n._saved_doc_title)&&p.registerPlugin(new xe.XE_AutoSave(r,u)),i(),p}function editorGetContentTextarea_xe(a){var b=xe.Editors[a]||null;if(!b)return"";var c=b.getIR();if(!jQuery.trim(c.replace(/(&nbsp;|<\/?(p|br|span|div)([^>]+)?>)/gi,"")))return"";if(c=c.replace(/<br ?\/?>$/i,""),c.length<1024){var d=Array("#text","A","BR","IMG","EM","STRONG","SPAN","BIG","CITE","CODE","DD","DFN","HR","INS","KBD","LINK","Q","SAMP","SMALL","SUB","SUP","TT"),e=!0,f=jQuery("<div>"+c+"</div>").eq(0),g=f.contents();jQuery.each(g,function(){3!=this.nodeType&&-1==jQuery.inArray(this.nodeName,d)&&(e=!1)}),e&&(c="<p>"+c+"</p>")}return c=c.replace(/src\s?=\s?(["']?)(?:\.\.\/)+(files\/attach\/)/gi,function(a,b,c){return"src="+(b||"")+c}),c=c.replace(/\<(\/)?([A-Z]+)([^>]*)\>/gi,function(a,b,c,d){return d=d?d.replace(/ ([A-Z]+?)\=/gi,function(a,b){return b=b.toLowerCase()," "+b+"="}):"",c=c.toLowerCase(),b||(b=""),"<"+b+c+d+">"}),c=c.replace("<br>","<br />")}function editorGetIframe(a){return jQuery("iframe#editor_iframe_"+a).get(0)}function editorReplaceHTML(a,b){b=editorReplacePath(b);var c=parseInt(a.id.replace(/^.*_/,""),10);editorRelKeys[c].pasteHTML(b)}function editorReplacePath(a){return a=a.replace(/\<([^\>\<]*)(src=|href=|url\()("|\')*([^"\'\)]+)("|\'|\))*(\s|>)*/gi,function(a,b,c,d,e,f,g){"url("==c?(d="",f=")"):("undefined"==typeof d&&(d='"'),"undefined"==typeof f&&(f='"'),"undefined"==typeof g&&(g=""));var h=jQuery.trim(e).replace(/^\.\//,"");return/^(http\:|https\:|ftp\:|telnet\:|mms\:|mailto\:|\/|\.\.|\#)/i.test(h)?a:"<"+b+c+d+request_uri+h+f+g})}function editorGetAutoSavedDoc(a){var b=new Array;b.mid=current_mid,b.editor_sequence=a.getAttribute("editor_sequence"),setTimeout(function(){var a=new Array("error","message","editor_sequence","title","content","document_srl");exec_xml("editor","procEditorLoadSavedDocument",b,function(a,c,d){editorRelKeys[b.editor_sequence].primary.value=a.document_srl,"object"==typeof uploadSettingObj[b.editor_sequence]&&editorUploadInit(uploadSettingObj[b.editor_sequence],!0)},a)},0)}!function(a){function b(b){function c(a){return function(){return a.apply(this.$this,arguments)}}var d=b.prototype;this.prototype.$super={};for(var e in d)d.propertyIsEnumerable(e)&&("undefined"==typeof this.prototype[e]&&(this.prototype[e]=d[e]),this.prototype.$super[e]=a.isFunction(d[e])?c(d[e]):d[e]);return this}a.extend({Class:function(c){function d(){"undefined"!=typeof this.$super&&(this.$super.$this=this),a.isFunction(this.$init)&&this.$init.apply(this,arguments)}return d.prototype=c,d.constructor=d,d.extend=b,d},$:function(b){return"string"==typeof b?"<"==b.substring(0,1)?a(b).get(0):a("#"+b).get(0):b},fnBind:function(b,c){var d=a.makeArray(arguments);return d.shift(),d.shift(),function(){var e=d.concat(a.makeArray(arguments));return b.apply(c,e)}}}),a.browser.nVersion=parseFloat(a.browser.version),"undefined"==typeof window.xe&&(window.xe={}),xe.XpressCore=a.Class({name:"XpressCore",$init:function(b){b=b?a.Class({}).extend({oDebugger:null}).extend(b):{},b.oDebugger&&(this.oDebugger=b.oDebugger,this.oDebugger.oApp=this),this.commandQueue=[],this.oCommandMap={},this.oDisabledCommand={},this.aPlugins=[],this.appStatus=xe.APP_STATUS.NOT_READY,this.registerPlugin(this)},exec:function(a,b,c){return this.appStatus==xe.APP_STATUS.NOT_READY?(this.commandQueue[this.commandQueue.length]={msg:a,args:b,event:c},!0):(this.exec=this._exec,void this.exec(a,b,c))},delayedExec:function(b,c,d,e){var f=a.fnBind(this.exec,this,b,c,e);setTimeout(f,d)},_exec:function(a,b,c){return(this._exec=this.oDebugger?this._execWithDebugger:this._execWithoutDebugger).call(this,a,b,c)},_execWithDebugger:function(a,b,c){this.oDebugger.log_MessageStart(a,b);var d=this._doExec(a,b,c);return this.oDebugger.log_MessageEnd(a,b),d},_execWithoutDebugger:function(a,b,c){return this._doExec(a,b,c)},_doExec:function(a,b,c){var d=!1;if(!this.oDisabledCommand[a]){var e=[];if(b&&b.length)for(var f=b.length,g=0;f>g;g++)e[g]=b[g];c&&(e[e.length]=c);var d=!0;d=this._execMsgStep("BEFORE",a,e),d&&(d=this._execMsgStep("ON",a,e)),d&&(d=this._execMsgStep("AFTER",a,e))}return d},registerPlugin:function(a){if(!a)throw"An error occured in registerPlugin(): invalid plug-in";return a.nIdx=this.aPlugins.length,a.oApp=this,this.aPlugins[a.nIdx]=a,a.status!=xe.PLUGIN_STATUS.NOT_READY&&(a.status=xe.PLUGIN_STATUS.READY),this.exec("MSG_PLUGIN_REGISTERED",[a]),a.nIdx},disableCommand:function(a,b){this.oDisabledCommand[a]=b},registerBrowserEvent:function(b,c,d,e,f){if(b){e=e||[];var g=f?a.fnBind(this.delayedExec,this,d,e,f):a.fnBind(this.exec,this,d,e);a(b).bind(c,g)}},run:function(){this._changeAppStatus(xe.APP_STATUS.WAITING_FOR_PLUGINS_READY);var a=this.commandQueue.length;for(i=0;i<a;i++){var b=this.commandQueue[i];this.exec(b.msg,b.args,b.event)}this._waitForPluginReady()},createCommandMap:function(a){this.oCommandMap[a]=[];for(var b=this.aPlugins.length,c=0;b>c;c++)this._doAddToCommandMap(a,this.aPlugins[c])},addToCommandMap:function(a,b){this.oCommandMap[a]&&this._addToCommandMap(a,b)},_changeAppStatus:function(a){this.appStatus=a,this.appStatus==xe.APP_STATUS.READY&&this.exec("MSG_APP_READY")},_execMsgStep:function(a,b,c){return(this._execMsgStep=this.oDebugger?this._execMsgStepWithDebugger:this._execMsgStepWithoutDebugger).call(this,a,b,c)},_execMsgStepWithDebugger:function(a,b,c){this.oDebugger.log_MessageStepStart(a,b,c);var d=this._execMsgHandler("$"+a+"_"+b,c);return this.oDebugger.log_MessageStepEnd(a,b,c),d},_execMsgStepWithoutDebugger:function(a,b,c){return this._execMsgHandler("$"+a+"_"+b,c)},_execMsgHandler:function(a,b){this.oCommandMap[a]||this.createCommandMap(a);var c=this.oCommandMap[a],d=c.length;if(0==d)return!0;var e,f=!0;if(a.match(/^\$(BEFORE|ON|AFTER)_MSG_APP_READY$/)){for(var g=0;d>g;g++)if(e=this._execHandler(c[g],a,b),e===!1){f=!1;break}}else for(var g=0;d>g;g++)if(("function"!=typeof c[g].$PRECONDITION||this._execHandler(c[g],"$PRECONDITION",[a,b]))&&(e=this._execHandler(c[g],a,b),e===!1)){f=!1;break}return f},_execHandler:function(a,b,c){return(this._execHandler=this.oDebugger?this._execHandlerWithDebugger:this._execHandlerWithoutDebugger).call(this,a,b,c)},_execHandlerWithDebugger:function(a,b,c){this.oDebugger.log_CallHandlerStart(a,b,c);var d=a[b].apply(a,c);return this.oDebugger.log_CallHandlerEnd(a,b,c),d},_execHandlerWithoutDebugger:function(a,b,c){return a[b].apply(a,c)},_doAddToCommandMap:function(a,b){"function"==typeof b[a]&&(this.oCommandMap[a][this.oCommandMap[a].length]=b)},_waitForPluginReady:function(){for(var b=!0,c=0;c<this.aPlugins.length;c++)if(this.aPlugins[c].status==xe.PLUGIN_STATUS.NOT_READY){b=!1;break}b?this._changeAppStatus(xe.APP_STATUS.READY):setTimeout(a.fnBind(this._waitForPluginReady,this),100)}}),xe.APP_STATUS={NOT_READY:0,WAITING_FOR_PLUGINS_READY:1,READY:2},xe.PLUGIN_STATUS={NOT_READY:0,READY:1},xe.W3CDOMRange=a.Class({$init:function(a){this._document=a||document,this.collapsed=!0,this.commonAncestorContainer=this._document.body,this.endContainer=this._document.body,this.endOffset=0,this.startContainer=this._document.body,this.startOffset=0},cloneContents:function(){var a=this._document.createDocumentFragment(),b=this._document.createDocumentFragment(),c=this._getNodesInRange();if(c.length<1)return a;var d=this._constructClonedTree(c,b),e=b.firstChild;if(e)for(var f,g=e.firstChild;g;)f=g.nextSibling,a.appendChild(g),g=f;return d=this._splitTextEndNodes({oStartContainer:d.oStartContainer,iStartOffset:this.startOffset,oEndContainer:d.oEndContainer,iEndOffset:this.endOffset}),d.oStartContainer&&d.oStartContainer.previousSibling&&xe.DOMFix.parentNode(d.oStartContainer).removeChild(d.oStartContainer.previousSibling),d.oEndContainer&&d.oEndContainer.nextSibling&&xe.DOMFix.parentNode(d.oEndContainer).removeChild(d.oEndContainer.nextSibling),a},_constructClonedTree:function(a,b){var c=null,d=null,e=this.startContainer,f=this.endContainer;return _recurConstructClonedTree=function(a,b,g,h){if(0>b)return b;var i=b-1,j=a[b].cloneNode(!1);for(a[b]==e&&(c=j),a[b]==f&&(d=j);i>=0&&xe.DOMFix.parentNode(a[i])==a[b];)i=this._recurConstructClonedTree(a,i,a[b],j,c,d);return h.insertBefore(j,h.firstChild),i},a[a.length]=xe.DOMFix.parentNode(a[a.length-1]),_recurConstructClonedTree(a,a.length-1,a[a.length-1],b),{oStartContainer:c,oEndContainer:d}},cloneRange:function(){return this._copyRange(new xe.W3CDOMRange(this._document))},_copyRange:function(a){return a.collapsed=this.collapsed,a.commonAncestorContainer=this.commonAncestorContainer,a.endContainer=this.endContainer,a.endOffset=this.endOffset,a.startContainer=this.startContainer,a.startOffset=this.startOffset,a._document=this._document,a},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset),this._updateRangeInfo()},compareBoundaryPoints:function(a,b){switch(a){case xe.W3CDOMRange.START_TO_START:return this._compareEndPoint(this.startContainer,this.startOffset,b.startContainer,b.startOffset);case xe.W3CDOMRange.START_TO_END:return this._compareEndPoint(this.endContainer,this.endOffset,b.startContainer,b.startOffset);case xe.W3CDOMRange.END_TO_END:return this._compareEndPoint(this.endContainer,this.endOffset,b.endContainer,b.endOffset);case xe.W3CDOMRange.END_TO_START:return this._compareEndPoint(this.startContainer,this.startOffset,b.endContainer,b.endOffset)}},_findBody:function(a){if(!a)return null;for(;a;){if("BODY"==a.tagName)return a;a=xe.DOMFix.parentNode(a)}return null},_compareEndPoint:function(a,b,c,d){var e,f;a&&this._findBody(a)==this._document.body||(a=this._document.body,b=0),c&&this._findBody(c)==this._document.body||(c=this._document.body,d=0);var g=function(a,b){return-1==b&&(b=a+1),b>a?-1:a==b?0:1},h=this._getCommonAncestorContainer(a,c),i=a;if(i!=h){for(;(oTmpNode=xe.DOMFix.parentNode(i))!=h;)i=oTmpNode;e=this._getPosIdx(i)+.5}else e=b;var j=c;if(j!=h){for(;(oTmpNode=xe.DOMFix.parentNode(j))!=h;)j=oTmpNode;f=this._getPosIdx(j)+.5}else f=d;return g(e,f)},_getCommonAncestorContainer:function(a,b){for(var c=b;a;){for(;c;){if(a==c)return a;c=xe.DOMFix.parentNode(c)}c=b,a=xe.DOMFix.parentNode(a)}return this._document.body},deleteContents:function(){if(!this.collapsed){this._splitTextEndNodesOfTheRange();var a=this._getNodesInRange();if(!(a.length<1)){for(var b=a[0].previousSibling;b&&this._isBlankTextNode(b);)b=b.previousSibling;var c,d;b||(c=xe.DOMFix.parentNode(a[0]),d=0);for(var e=0;e<a.length;e++){var f=a[e];f.firstChild||(c==f&&(d=this._getPosIdx(c),c=xe.DOMFix.parentNode(f)),xe.DOMFix.parentNode(f).removeChild(f))}b?"BODY"==b.tagName?this.setStartBefore(b):this.setStartAfter(b):this.setStart(c,d),this.collapse(!0)}}},extractContents:function(){var a=this.cloneContents();return this.deleteContents(),a},insertNode:function(a){var b,c=null;"3"==this.startContainer.nodeType?(b=xe.DOMFix.parentNode(this.startContainer),c=this.startContainer.nodeValue.length<=this.startOffset?this.startContainer.nextSibling:this.startContainer.splitText(this.startOffset)):(b=this.startContainer,c=xe.DOMFix.childNodes(this.startContainer)[this.startOffset]),c&&xe.DOMFix.parentNode(c)||(c=null),b.insertBefore(a,c),this.setStartBefore(a)},selectNode:function(a){this.setStartBefore(a),this.setEndAfter(a)},selectNodeContents:function(a){this.setStart(a,0),this.setEnd(a,xe.DOMFix.childNodes(a).length)},_endsNodeValidation:function(a,b){if(!a||this._findBody(a)!=this._document.body)throw new Error("INVALID_NODE_TYPE_ERR oNode is not part of current document");return 3==a.nodeType?b>a.nodeValue.length&&(b=a.nodeValue.length):b>xe.DOMFix.childNodes(a).length&&(b=xe.DOMFix.childNodes(a).length),b},setEnd:function(a,b){b=this._endsNodeValidation(a,b),this.endContainer=a,this.endOffset=b,this.startContainer&&-1==this._compareEndPoint(this.startContainer,this.startOffset,this.endContainer,this.endOffset)||this.collapse(!1),this._updateRangeInfo()},setEndAfter:function(a){if(!a)throw new Error("INVALID_NODE_TYPE_ERR in setEndAfter");return"BODY"==a.tagName?void this.setEnd(a,xe.DOMFix.childNodes(a).length):void this.setEnd(xe.DOMFix.parentNode(a),this._getPosIdx(a)+1)},setEndBefore:function(a){if(!a)throw new Error("INVALID_NODE_TYPE_ERR in setEndBefore");return"BODY"==a.tagName?void this.setEnd(a,0):void this.setEnd(xe.DOMFix.parentNode(a),this._getPosIdx(a))},setStart:function(a,b){b=this._endsNodeValidation(a,b),this.startContainer=a,this.startOffset=b,this.endContainer&&-1==this._compareEndPoint(this.startContainer,this.startOffset,this.endContainer,this.endOffset)||this.collapse(!0),this._updateRangeInfo()},setStartAfter:function(a){if(!a)throw new Error("INVALID_NODE_TYPE_ERR in setStartAfter");return"BODY"==a.tagName?void this.setStart(a,xe.DOMFix.childNodes(a).length):void this.setStart(xe.DOMFix.parentNode(a),this._getPosIdx(a)+1)},setStartBefore:function(a){if(!a)throw new Error("INVALID_NODE_TYPE_ERR in setStartBefore");return"BODY"==a.tagName?void this.setStart(a,0):void this.setStart(xe.DOMFix.parentNode(a),this._getPosIdx(a))},surroundContents:function(a){a.appendChild(this.extractContents()),this.insertNode(a),this.selectNode(a)},toString:function(){var a=this._document.createElement("DIV");return a.appendChild(this.cloneContents()),a.textContent||a.innerText||""},_isBlankTextNode:function(a){return 3==a.nodeType&&""==a.nodeValue},_getPosIdx:function(a){for(var b=0,c=a.previousSibling;c;c=c.previousSibling)b++;return b},_updateRangeInfo:function(){return this.startContainer?(this.collapsed=this._isCollapsed(this.startContainer,this.startOffset,this.endContainer,this.endOffset),void(this.commonAncestorContainer=this._getCommonAncestorContainer(this.startContainer,this.endContainer))):void this.init(this._document)},_isCollapsed:function(a,b,c,d){var e=!1;if(a==c&&b==d)e=!0;else{var f=this._getActualStartNode(a,b),g=this._getActualEndNode(c,d);f=this._getNextNode(this._getPrevNode(f)),g=this._getPrevNode(this._getNextNode(g)),f&&g&&"BODY"!=g.tagName&&(this._getNextNode(g)==f||g==f&&this._isBlankTextNode(g))&&(e=!0)}return e},_splitTextEndNodesOfTheRange:function(){var a=this._splitTextEndNodes({oStartContainer:this.startContainer,iStartOffset:this.startOffset,oEndContainer:this.endContainer,iEndOffset:this.endOffset});this.startContainer=a.oStartContainer,this.startOffset=a.iStartOffset,this.endContainer=a.oEndContainer,this.endOffset=a.iEndOffset},_splitTextEndNodes:function(a){return a=this._splitStartTextNode(a),a=this._splitEndTextNode(a)},_splitStartTextNode:function(a){var b=a.oStartContainer,c=a.iStartOffset,d=a.oEndContainer,e=a.iEndOffset;if(!b)return a;if(3!=b.nodeType)return a;if(0==c)return a;if(b.nodeValue.length<=c)return a;var f=b.splitText(c);return b==d&&(e-=c,d=f),b=f,c=0,{oStartContainer:b,iStartOffset:c,oEndContainer:d,iEndOffset:e}},_splitEndTextNode:function(a){var b=a.oStartContainer,c=a.iStartOffset,d=a.oEndContainer,e=a.iEndOffset;return d?3!=d.nodeType?a:e>=d.nodeValue.length?a:0==e?a:(d.splitText(e),{oStartContainer:b,iStartOffset:c,oEndContainer:d,iEndOffset:e}):a},_getNodesInRange:function(){if(this.collapsed)return[];var a=this._getActualStartNode(this.startContainer,this.startOffset),b=this._getActualEndNode(this.endContainer,this.endOffset);return this._getNodesBetween(a,b)},_getActualStartNode:function(a,b){var c=a;return 3==a.nodeType?b>=a.nodeValue.length?(c=this._getNextNode(a),"BODY"==c.tagName&&(c=null)):c=a:b<xe.DOMFix.childNodes(a).length?c=xe.DOMFix.childNodes(a)[b]:(c=this._getNextNode(a),"BODY"==c.tagName&&(c=null)),c},_getActualEndNode:function(a,b){var c=a;return 0==b?(c=this._getPrevNode(a),"BODY"==c.tagName&&(c=null)):c=3==a.nodeType?a:xe.DOMFix.childNodes(a)[b-1],c},_getNextNode:function(a){return a&&"BODY"!=a.tagName?a.nextSibling?a.nextSibling:this._getNextNode(xe.DOMFix.parentNode(a)):this._document.body},_getPrevNode:function(a){return a&&"BODY"!=a.tagName?a.previousSibling?a.previousSibling:this._getPrevNode(xe.DOMFix.parentNode(a)):this._document.body},_getNodesBetween:function(a,b){var c=[];return this._nNodesBetweenLen=0,a&&b?(this._recurGetNextNodesUntil(a,b,c),c):c},_recurGetNextNodesUntil:function(a,b,c){if(!a)return!1;if(!this._recurGetChildNodesUntil(a,b,c))return!1;for(var d=a.nextSibling;!d;){if(!(a=xe.DOMFix.parentNode(a)))return!1;if(c[this._nNodesBetweenLen++]=a,a==b)return!1;d=a.nextSibling}return this._recurGetNextNodesUntil(d,b,c)},_recurGetChildNodesUntil:function(a,b,c){if(!a)return!1;var d=!1,e=a;if(e.firstChild)for(e=e.firstChild;e;){if(!this._recurGetChildNodesUntil(e,b,c)){d=!0;break}e=e.nextSibling}return c[this._nNodesBetweenLen++]=a,d?!1:a!=b}}),xe.W3CDOMRange.START_TO_START=0,xe.W3CDOMRange.START_TO_END=1,xe.W3CDOMRange.END_TO_END=2,xe.W3CDOMRange.END_TO_START=3,xe.XpressRange=a.Class({setWindow:function(a){this._window=a,this._document=a.document},$init:function(a){this.HUSKY_BOOMARK_START_ID_PREFIX="xpress_bookmark_start_",this.HUSKY_BOOMARK_END_ID_PREFIX="xpress_bookmark_end_",this.sBlockElement="P|DIV|LI|H[1-6]|PRE",this.sBlockContainer="BODY|TABLE|TH|TR|TD|UL|OL|BLOCKQUOTE|FORM",this.rxBlockElement=new RegExp("^("+this.sBlockElement+")$"),this.rxBlockContainer=new RegExp("^("+this.sBlockContainer+")$"),this.rxLineBreaker=new RegExp("^("+this.sBlockElement+"|"+this.sBlockContainer+")$"),this.setWindow(a),this.oSimpleSelection=new xe.SimpleSelection(this._window),this.selectionLoaded=this.oSimpleSelection.selectionLoaded,this.$super.$init(this._document)},select:function(){this.oSimpleSelection.selectRange(this)},setFromSelection:function(a){this.setRange(this.oSimpleSelection.getRangeAt(a))},setRange:function(a){this.setStart(a.startContainer,a.startOffset),this.setEnd(a.endContainer,a.endOffset)},setEndNodes:function(a,b){this.setEndAfter(b),this.setStartBefore(a)},splitTextAtBothEnds:function(){this._splitTextEndNodesOfTheRange()},getStartNode:function(){return this.collapsed?3==this.startContainer.nodeType?0==this.startOffset?null:this.startContainer.nodeValue.length<=this.startOffset?null:this.startContainer:null:3==this.startContainer.nodeType?this.startOffset>=this.startContainer.nodeValue.length?this._getNextNode(this.startContainer):this.startContainer:this.startOffset>=xe.DOMFix.childNodes(this.startContainer).length?this._getNextNode(this.startContainer):xe.DOMFix.childNodes(this.startContainer)[this.startOffset]},getEndNode:function(){return this.collapsed?this.getStartNode():3==this.endContainer.nodeType?0==this.endOffset?this._getPrevNode(this.endContainer):this.endContainer:0==this.endOffset?this._getPrevNode(this.endContainer):xe.DOMFix.childNodes(this.endContainer)[this.endOffset-1]},getNodeAroundRange:function(a,b){if(this.collapsed&&this.startContainer&&3==this.startContainer.nodeType)return this.startContainer;if(!this.collapsed||this.startContainer&&3==this.startContainer.nodeType)return this.getStartNode();var c,d,e;return d=this.startOffset>=xe.DOMFix.childNodes(this.startContainer).length?this._getNextNode(this.startContainer):xe.DOMFix.childNodes(this.startContainer)[this.startOffset],c=0==this.endOffset?this._getPrevNode(this.endContainer):xe.DOMFix.childNodes(this.endContainer)[this.endOffset-1],a?(e=c,e||b||(e=d)):(e=d,e||b||(e=c)),e},_getXPath:function(a){for(var b="";a&&1==a.nodeType;)b="/"+a.tagName+"["+this._getPosIdx4XPath(a)+"]"+b,a=xe.DOMFix.parentNode(a);return b},_getPosIdx4XPath:function(a){for(var b=0,c=a.previousSibling;c;c=c.previousSibling)c.tagName==a.tagName&&b++;return b},_evaluateXPath:function(a,b){a=a.substring(1,a.length-1);for(var c=a.split(/\//),d=b.body,e=2;e<c.length&&d;e++){c[e].match(/([^\[]+)\[(\d+)/i);for(var f=RegExp.$1,g=RegExp.$2,h=xe.DOMFix.childNodes(d),i=[],j=h.length,k=0,l=0;j>l;l++)h[l].tagName==f&&(i[k++]=h[l]);d=i.length<g?null:i[g]}return d},_evaluateXPathBookmark:function(a){var b=a.sXPath,c=a.nTextNodeIdx,d=a.nOffset,e=this._evaluateXPath(b,this._document);if(c>-1&&e){for(var f=xe.DOMFix.childNodes(e),g=null,h=c,i=d;(g=f[h])&&3==g.nodeType&&g.nodeValue.length<i;)i-=g.nodeValue.length,h++;e=xe.DOMFix.childNodes(e)[h],d=i}return e||(e=this._document.body,d=0),{elContainer:e,nOffset:d}},getXPathBookmark:function(){var a=-1,b={elContainer:this.startContainer,nOffset:this.startOffset},c=this.startContainer;3==c.nodeType&&(b=this._getFixedStartTextNode(),a=this._getPosIdx(b.elContainer),c=xe.DOMFix.parentNode(c));var d=this._getXPath(c),e={sXPath:d,nTextNodeIdx:a,nOffset:b.nOffset},f=-1,g={elContainer:this.endContainer,nOffset:this.endOffset},h=this.endContainer;3==h.nodeType&&(g=this._getFixedEndTextNode(),f=this._getPosIdx(g.elContainer),h=xe.DOMFix.parentNode(h));var i=this._getXPath(h),j={sXPath:i,nTextNodeIdx:f,nOffset:g.nOffset};return[e,j]},moveToXPathBookmark:function(a){if(a){var b=this._evaluateXPathBookmark(a[0]),c=this._evaluateXPathBookmark(a[1]);b.elContainer&&c.elContainer&&(this.startContainer=b.elContainer,this.startOffset=b.nOffset,this.endContainer=c.elContainer,this.endOffset=c.nOffset)}},_getFixedTextContainer:function(a,b){for(;a&&3==a.nodeType&&a.previousSibling&&3==a.previousSibling.nodeType;)b+=a.previousSibling.nodeValue.length,a=a.previousSibling;return{elContainer:a,nOffset:b}},_getFixedStartTextNode:function(){return this._getFixedTextContainer(this.startContainer,this.startOffset)},_getFixedEndTextNode:function(){return this._getFixedTextContainer(this.endContainer,this.endOffset)},placeStringBookmark:function(){var a=(new Date).getTime(),b=this.cloneRange();b.collapseToEnd();var c=this._document.createElement("A");c.id=this.HUSKY_BOOMARK_END_ID_PREFIX+a,b.insertNode(c);var b=this.cloneRange();b.collapseToStart();var d=this._document.createElement("A");return d.id=this.HUSKY_BOOMARK_START_ID_PREFIX+a,b.insertNode(d),this.moveToBookmark(a),a},cloneRange:function(){return this._copyRange(new xe.XpressRange(this._window))},moveToBookmark:function(a){"object"!=typeof a?this.moveToStringBookmark(a):this.moveToXPathBookmark(a)},moveToStringBookmark:function(a){var b=this._document.getElementById(this.HUSKY_BOOMARK_START_ID_PREFIX+a),c=this._document.getElementById(this.HUSKY_BOOMARK_END_ID_PREFIX+a);b&&c&&(this.setEndBefore(c),this.setStartAfter(b))},removeStringBookmark:function(a){var b=this._document.getElementById(this.HUSKY_BOOMARK_START_ID_PREFIX+a),c=this._document.getElementById(this.HUSKY_BOOMARK_END_ID_PREFIX+a);b&&xe.DOMFix.parentNode(b).removeChild(b),c&&xe.DOMFix.parentNode(c).removeChild(c)},collapseToStart:function(){this.collapse(!0)},collapseToEnd:function(){this.collapse(!1)},createAndInsertNode:function(a){return tmpNode=this._document.createElement(tagName),this.insertNode(tmpNode),tmpNode},getNodes:function(a,b){a&&this._splitTextEndNodesOfTheRange();var c=this._getNodesInRange(),d=[];if(!b)return c;for(var e=0;e<c.length;e++)b(c[e])&&(d[d.length]=c[e]);return d},getTextNodes:function(a){var b=function(a){return 3==a.nodeType&&"\n"!=a.nodeValue&&""!=a.nodeValue};return this.getNodes(a,b)},surroundContentsWithNewNode:function(a){var b=this._document.createElement(a);return this.surroundContents(b),b},isRangeinRange:function(a,b){var c=this.compareBoundaryPoints(this.START_TO_START,a),d=this.compareBoundaryPoints(this.START_TO_END,a),e=this.compareBoundaryPoints(this.END_TO_START,a),f=this.compareBoundaryPoints(this.END_TO_END,a);return 0>=c&&f>=0?!0:bIncludePartlyIncluded?1==d?!1:-1!=e:!1},isNodeInRange:function(a,b,c){var d=new xe.XpressRange(this._window);return c&&a.firstChild?(d.setStartBefore(a.firstChild),d.setEndAfter(a.lastChild)):d.selectNode(a),isRangeInRange(d,b)},pasteHTML:function(a){if(""==a)return void this.deleteContents();var b=this._document.createElement("DIV");b.innerHTML=a;for(var c=b.firstChild,d=b.lastChild,e=this.cloneRange(),f=e.placeStringBookmark();b.lastChild;)this.insertNode(b.lastChild);this.setEndNodes(c,d),e.moveToBookmark(f),e.deleteContents(),e.removeStringBookmark(f)},toString:function(){return this.toString=xe.W3CDOMRange.prototype.toString,this.toString()},toHTMLString:function(){var a=this._document.createElement("DIV");return a.appendChild(this.cloneContents()),a.innerHTML},findAncestorByTagName:function(a){for(var b=this.commonAncestorContainer;b&&b.tagName!=a;)b=xe.DOMFix.parentNode(b);return b},selectNodeContents:function(a){if(a){var b=a.firstChild?a.firstChild:a,c=a.lastChild?a.lastChild:a;3==b.nodeType?this.setStart(b,0):this.setStartBefore(b),3==c.nodeType?this.setEnd(c,c.nodeValue.length):this.setEndAfter(c)}},styleRange:function(b,c,d){var e=this._getStyleParentNodes(d);if(!(e.length<1)){for(var f,g,h=0;h<e.length;h++){for(var i in b)f=i,g=b[f],"string"==typeof g&&(e[h].style[f]=g);if(c)for(var i in c)f=i,g=c[f],"string"==typeof g&&("class"==f?a(e[h]).addClass(g):e[h].setAttribute(f,g))}this.setStartBefore(e[0]),this.setEndAfter(e[e.length-1])}},_getStyleParentNodes:function(b){this._splitTextEndNodesOfTheRange();for(var c,d,e,f,g,h,i=this.getStartNode(),j=this.getEndNode(),k=this._getNodesInRange(),l=[],m=0,n=k.length,o=(a(k).filter(function(){return!!this.childNodes.length}),0);n>o;o++)if(c=k[o],c&&3==c.nodeType&&""!=c.nodeValue){if(h=xe.DOMFix.parentNode(c),"SPAN"==h.tagName){var p=a(h).html();if(d=this._getVeryFirstRealChild(h),f=d==c?1:p.indexOf(d),-1!=f&&(d=this._getVeryLastRealChild(h),g=d==c?1:p.indexOf(d)),-1!=f&&-1!=g){l[m++]=h;continue}}e=this._document.createElement("SPAN"),h.insertBefore(e,c),e.appendChild(c),l[m++]=e,b&&e.setAttribute(b,"true")}return this.setStartBefore(i),this.setEndAfter(j),l},_getVeryFirstChild:function(a){return a.firstChild?this._getVeryFirstChild(a.firstChild):a},_getVeryLastChild:function(a){return a.lastChild?this._getVeryLastChild(a.lastChild):a},_getFirstRealChild:function(a){for(var b=a.firstChild;b&&3==b.nodeType&&""==b.nodeValue;)b=b.nextSibling;return b},_getLastRealChild:function(a){for(var b=a.lastChild;b&&3==b.nodeType&&""==b.nodeValue;)b=b.previousSibling;return b},_getVeryFirstRealChild:function(a){var b=this._getFirstRealChild(a);return b?this._getVeryFirstRealChild(b):a},_getVeryLastRealChild:function(a){var b=this._getLastRealChild(a);return b?this._getVeryLastChild(b):a},_getLineStartInfo:function(a){function b(a){if(a&&!d){if(h.test(a.tagName))return f=a,d=e,void(g=!0);e=a,c(a.previousSibling),d||b(xe.DOMFix.parentNode(a))}}function c(a){if(a&&!d){if(h.test(a.tagName))return f=a,d=e,void(g=!1);if(a.firstChild&&"TABLE"!=a.tagName)for(var b=a.lastChild;b&&!d;)c(b),b=b.previousSibling;else e=a;d||c(a.previousSibling)}}var d=null,e=a,f=a,g=!0,h=this.rxLineBreaker;return b(a),{oNode:d,oLineBreaker:f,bParentBreak:g}},_getLineEndInfo:function(a){function b(a){if(a&&!d){if(h.test(a.tagName))return f=a,d=e,void(g=!0);e=a,c(a.nextSibling),d||b(xe.DOMFix.parentNode(a))}}function c(a){if(a&&!d){if(h.test(a.tagName))return f=a,d=e,void(g=!1);if(a.firstChild&&"TABLE"!=a.tagName)for(var b=a.firstChild;b&&!d;)c(b),b=b.nextSibling;else e=a;d||c(a.nextSibling)}}var d=null,e=a,f=a,g=!0,h=this.rxLineBreaker;return b(a),{oNode:d,oLineBreaker:f,bParentBreak:g}},getLineInfo:function(){var a=this.getStartNode(),b=this.getEndNode();a||(a=this.getNodeAroundRange(!0,!0)),b||(b=this.getNodeAroundRange(!0,!0));var c=this._getLineStartInfo(a),d=c.oNode,e=this._getLineEndInfo(b),f=e.oNode,g=this._compareEndPoint(xe.DOMFix.parentNode(d),this._getPosIdx(d),this.endContainer,this.endOffset),h=this._compareEndPoint(xe.DOMFix.parentNode(f),this._getPosIdx(f)+1,this.startContainer,this.startOffset);return 0>=g&&h>=0||(a=this.getNodeAroundRange(!1,!0),b=this.getNodeAroundRange(!1,!0),c=this._getLineStartInfo(a),e=this._getLineEndInfo(b)),{oStart:c,oEnd:e}}}).extend(xe.W3CDOMRange),xe.SimpleSelection=function(b){this.init=function(a){this._window=a||window,this._document=this._window.document},this.init(b),a.browser.msie?xe.SimpleSelectionImpl_IE.apply(this):xe.SimpleSelectionImpl_FF.apply(this),this.selectRange=function(a){this.selectNone(),this.addRange(a)},this.selectionLoaded=!0,this._oSelection||(this.selectionLoaded=!1)},xe.SimpleSelectionImpl_FF=function(){this._oSelection=this._window.getSelection(),this.getRangeAt=function(a){a=a||0;try{var b=this._oSelection.getRangeAt(a)}catch(c){return new xe.W3CDOMRange(this._document)}return this._FFRange2W3CRange(b)},this.addRange=function(a){var b=this._W3CRange2FFRange(a);this._oSelection.addRange(b)},this.selectNone=function(){this._oSelection.removeAllRanges()},this._FFRange2W3CRange=function(a){var b=new xe.W3CDOMRange(this._document);return b.setStart(a.startContainer,a.startOffset),b.setEnd(a.endContainer,a.endOffset),b},this._W3CRange2FFRange=function(a){var b=this._document.createRange();return b.setStart(a.startContainer,a.startOffset),
b.setEnd(a.endContainer,a.endOffset),b}},xe.SimpleSelectionImpl_IE=function(){this._oSelection=this._document.selection,this.getRangeAt=function(a){if(a=a||0,"Control"==this._oSelection.type){var b=new xe.W3CDOMRange(this._document),c=this._oSelection.createRange().item(a);return c&&c.ownerDocument==this._document?(b.selectNode(c),b):b}var c=this._oSelection.createRangeCollection().item(a).parentElement();if(!c||c.ownerDocument!=this._document){var b=new xe.W3CDOMRange(this._document);return b}return this._IERange2W3CRange(this._oSelection.createRangeCollection().item(a))},this.addRange=function(a){var b=this._W3CRange2IERange(a);b.select()},this.selectNone=function(){this._oSelection.empty()},this._W3CRange2IERange=function(a){var b=this._getIERangeAt(a.startContainer,a.startOffset),c=this._getIERangeAt(a.endContainer,a.endOffset);return b.setEndPoint("EndToEnd",c),b},this._getIERangeAt=function(a,b){var c=this._document.body.createTextRange(),d=this._getSelectableNodeAndOffsetForIE(a,b),e=d.oSelectableNodeForIE,f=d.iOffsetForIE;return c.moveToElementText(e),c.collapse(d.bCollapseToStart),c.moveStart("character",f),c},this._getSelectableNodeAndOffsetForIE=function(a,b){var c=this._document.body.createTextRange(),d=null,e=null,f=0;3==a.nodeType?(d=xe.DOMFix.parentNode(a),e=xe.DOMFix.childNodes(d),f=e.length):(d=a,e=xe.DOMFix.childNodes(d),f=b);for(var g=null,h=0,i=!0,j=0;f>j;j++)if(g=e[j],3==g.nodeType){if(g==a)break;h+=g.nodeValue.length}else c.moveToElementText(g),d=g,h=0,i=!1;return 3==a.nodeType&&(h+=b),{oSelectableNodeForIE:d,iOffsetForIE:h,bCollapseToStart:i}},this._IERange2W3CRange=function(a){var b=new xe.W3CDOMRange(this._document),c=null,d=null;c=a.duplicate(),c.collapse(!0),d=this._getW3CContainerAndOffset(c,!0),b.setStart(d.oContainer,d.iOffset);var e=a.duplicate();return e.collapse(!0),e.isEqual(a)?b.collapse(!0):(c=a.duplicate(),c.collapse(!1),d=this._getW3CContainerAndOffset(c),b.setEnd(d.oContainer,d.iOffset)),b},this._getW3CContainerAndOffset=function(a,b){for(var c=a,d=c.parentElement(),e=-1,f=this._document.body.createTextRange(),g=xe.DOMFix.childNodes(d),h=null,i=0,j=0;j<g.length;j++)if(3!=g[j].nodeType){if(f.moveToElementText(g[j]),f.compareEndPoints("StartToStart",a)>=0)break;h=g[j]}var i=j;if(0!=i&&3==g[i-1].nodeType){var k=this._document.body.createTextRange(),l=null;h?(k.moveToElementText(h),k.collapse(!1),l=h.nextSibling):(k.moveToElementText(d),k.collapse(!0),l=d.firstChild);var m=c.duplicate();m.setEndPoint("StartToStart",k);for(var n=m.text.length;n>l.nodeValue.length&&l.nextSibling;)n-=l.nodeValue.length,l=l.nextSibling;l.nodeValue;b&&l.nextSibling&&3==l.nextSibling.nodeType&&n==l.nodeValue.length&&(n-=l.nodeValue.length,l=l.nextSibling),d=l,e=n}else d=c.parentElement(),e=i;return{oContainer:d,iOffset:e}}},xe.DOMFix=new(a.Class({$init:function(){a.browser.msie||a.browser.opera?(this.childNodes=this._childNodes_Fix,this.parentNode=this._parentNode_Fix):(this.childNodes=this._childNodes_Native,this.parentNode=this._parentNode_Native)},_parentNode_Native:function(a){return a.parentNode},_parentNode_Fix:function(a){if(!a)return a;for(;a.previousSibling;)a=a.previousSibling;return a.parentNode},_childNodes_Native:function(a){return a.childNodes},_childNodes_Fix:function(a){var b=null,c=0;if(a){var b=[];for(a=a.firstChild;a;)b[c++]=a,a=a.nextSibling}return b}})),xe.DraggableLayer=a.Class({$init:function(b,c){this.oOptions=a.extend({bModal:"false",oHandle:b,iMinX:-999999,iMinY:-999999,iMaxX:999999,iMaxY:999999},c),this.oHandle=this.oOptions.oHandle,b.style.display="block",b.style.position="absolute",b.style.zIndex="9999",this.aBasePosition=this.getBaseOffset(b),b.style.top=this.toInt(a(b).offset().top)-this.aBasePosition.top+"px",b.style.left=this.toInt(a(b).offset().left)-this.aBasePosition.left+"px",this.$FnMouseDown=a.fnBind(this._mousedown,this,b),this.$FnMouseMove=a.fnBind(this._mousemove,this,b),this.$FnMouseUp=a.fnBind(this._mouseup,this,b),a(this.oHandle).bind("mousedown",this.$FnMouseDown)},_mousedown:function(b,c){"INPUT"!=c.target.tagName&&(this.MouseOffsetY=c.pageY-this.toInt(b.style.top)-this.aBasePosition.top,this.MouseOffsetX=c.pageX-this.toInt(b.style.left)-this.aBasePosition.left,a(b).bind("mousemove",this.$FnMouseMove),a(b).bind("mouseup",this.$FnMouseUp))},_mousemove:function(a,b){var c=b.pageY-this.MouseOffsetY-this.aBasePosition.top,d=b.pageX-this.MouseOffsetX-this.aBasePosition.left;c<this.oOptions.iMinY&&(c=this.oOptions.iMinY),c>this.oOptions.iMaxY&&(c=this.oOptions.iMaxY),d<this.oOptions.iMinX&&(d=this.oOptions.iMinX),d>this.oOptions.iMaxX&&(d=this.oOptions.iMaxX),a.style.top=c+"px",a.style.left=d+"px"},_mouseup:function(b,c){a(b).unbind("mousemove",this.$FnMouseMove),a(b).unbind("mouseup",this.$FnMouseUp)},toInt:function(a){var b=parseInt(a);return b||0},findNonStatic:function(b){return b?"BODY"==b.tagName?b:a(b).css("position").match(/absolute|relative/i)?b:this.findNonStatic(b.offsetParent):null},getBaseOffset:function(b){var c=this.findNonStatic(b.offsetParent),d=a(c).offset();return{top:d.top,left:d.left}}}),xe.CorePlugin=a.Class({name:"CorePlugin",$init:function(a){this.funcOnReady=a},$AFTER_MSG_APP_READY:function(){this.oApp.exec("EXEC_ON_READY_FUNCTION",[])},$ON_ADD_APP_PROPERTY:function(a,b){this.oApp[a]=b},$ON_REGISTER_BROWSER_EVENT:function(a,b,c,d,e){this.oApp.registerBrowserEvent(a,b,c,d,e)},$ON_DISABLE_COMMAND:function(a){this.oApp.disableCommand(a,!0)},$ON_ENABLE_COMMAND:function(a){this.oApp.disableCommand(a,!1)},$ON_EXEC_ON_READY_FUNCTION:function(){"function"==typeof this.funcOnReady&&this.funcOnReady()}}),xe.Utils=a.Class({name:"Utils",$init:function(){if(a.browser.msie&&6==a.browser.nVersion)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(b){}},$ON_ATTACH_HOVER_EVENTS:function(b,c){c=c||"hover",b&&a(b).hover(function(){a(this).addClass(c)},function(){a(this).removeClass(c)})}}),xe.XpressRangeManager=a.Class({name:"XpressRangeManager",oWindow:null,$init:function(a){this.oWindow=a||window},$BEFORE_MSG_APP_READY:function(){this.oWindow&&"IFRAME"==this.oWindow.tagName&&(this.oWindow=this.oWindow.contentWindow),this.oApp.exec("ADD_APP_PROPERTY",["getSelection",a.fnBind(this.getSelection,this)]),this.oApp.exec("ADD_APP_PROPERTY",["getEmptySelection",a.fnBind(this.getEmptySelection,this)])},$ON_SET_EDITING_WINDOW:function(a){this.oWindow=a},getEmptySelection:function(){var a=new xe.XpressRange(this.oWindow);return a},getSelection:function(){this.oApp.exec("RESTORE_IE_SELECTION",[]);var a=this.getEmptySelection();try{a.setFromSelection()}catch(b){}return a}}),xe.Hotkey=a.Class({name:"Hotkey",storage:{},keyhash:{},$init:function(){this.storage={},this.keyhash={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,meta:224,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46,comma:188,period:190,slash:191,hyphen:109,equal:61},(a.browser.msie||a.browser.safari)&&(this.keyhash.hyphen=189,this.keyhash.equal=187,this.keyhash.meta=91)},$ON_MSG_APP_READY:function(){a(this.oApp.getWYSIWYGDocument()||document).keydown(a.fnBind(this.keydown,this))},$ON_REGISTER_HOTKEY:function(b,c,d){d||(d=[]);var e=a.fnBind(this.oApp.exec,this.oApp,c,d);return(b=this.normalize(b))?void this.add(b,e):!1},add:function(a,b){"undefined"==typeof this.storage[a]?this.storage[a]=[b]:this.storage[a].push(b)},keydown:function(b){var c=[],d=this.keyhash;if(!(a.inArray(b.keyCode,[d.shift,d.ctrl,d.alt,d.meta])>=0)&&(b.shiftKey&&c.push("shift"),b.altKey&&c.push("alt"),b.ctrlKey&&c.push("ctrl"),b.metaKey&&c.push("meta"),c.length&&(1==c.length&&b.metaKey&&(c=["ctrl","meta"]),c.push(b.keyCode),c=c.join("+"),this.storage[c])))return a.each(this.storage[c],function(){this()}),!1},normalize:function(b){var c,d,e,f,g,h=(b||"").toLowerCase().split("+");return c=d=e=f=g=!1,a.each(h,function(){var a=""+this;switch(a){case"shift":c=!0;case"alt":e=!0;case"ctrl":d=!0;case"meta":f=!0;default:g=a}}),g?(h=[],c&&h.push("shift"),e&&h.push("alt"),d&&h.push("ctrl"),(f||d&&!c&&!e)&&h.push("meta"),h.push(this.keyhash[g]||g.toUpperCase().charCodeAt(0)),h.join("+")):""}}),xe.DialogLayerManager=a.Class({name:"DialogLayerManager",aMadeDraggable:null,aOpenedLayers:null,$init:function(){this.aMadeDraggable=[],this.aOpenedLayers=[]},$ON_SHOW_DIALOG_LAYER:function(b,c){b=a.$(b),c=a.$(c)||!1,b&&-1==a.inArray(b,this.aOpenedLayers)&&(this.oApp.exec("POSITION_DIALOG_LAYER",[b]),this.aOpenedLayers[this.aOpenedLayers.length]=b,-1==a.inArray(b,this.aMadeDraggable)?(new xe.DraggableLayer(b,{bModal:c,iMinY:0}),this.aMadeDraggable[this.aMadeDraggable.length]=b):b.style.display="block")},$ON_HIDE_LAST_DIALOG_LAYER:function(){this.oApp.exec("HIDE_DIALOG_LAYER",[this.aOpenedLayers[this.aOpenedLayers.length-1]])},$ON_HIDE_ALL_DIALOG_LAYER:function(){for(var a=this.aOpenedLayers.length-1;a>=0;a--)this.oApp.exec("HIDE_DIALOG_LAYER",[this.aOpenedLayers[a]])},$ON_HIDE_DIALOG_LAYER:function(b){b=a.$(b),b&&(b.style.display="none"),this.aOpenedLayers=a.grep(this.aOpenedLayers,function(a){return a!=b})},$ON_SET_DIALOG_LAYER_POSITION:function(a,b,c){a.style.top=b,a.style.left=c}}),xe.ActiveLayerManager=a.Class({name:"ActiveLayerManager",oCurrentLayer:null,$ON_TOGGLE_ACTIVE_LAYER:function(a,b,c,d,e){a==this.oCurrentLayer?this.oApp.exec("HIDE_ACTIVE_LAYER",[]):(this.oApp.exec("SHOW_ACTIVE_LAYER",[a,d,e]),b&&this.oApp.exec(b,c))},$ON_SHOW_ACTIVE_LAYER:function(b,c,d){b=a.$(b),this.sOnCloseCmd=c,this.aOnCloseParam=d;var e=this.oCurrentLayer;b!=e&&(this.oApp.exec("HIDE_ACTIVE_LAYER",[]),b.style.display="block",this.oCurrentLayer=b)},$ON_HIDE_ACTIVE_LAYER:function(){var a=this.oCurrentLayer;a&&(a.style.display="none",this.oCurrentLayer=null,this.sOnCloseCmd&&this.oApp.exec(this.sOnCloseCmd,this.aOnCloseParam))},$ON_HIDE_CURRENT_ACTIVE_LAYER:function(){this.oApp.exec("HIDE_ACTIVE_LAYER",[])},$ON_EVENT_EDITING_AREA_KEYDOWN:function(){this.oApp.exec("HIDE_ACTIVE_LAYER",[])},$ON_EVENT_EDITING_AREA_MOUSEDOWN:function(){this.oApp.exec("HIDE_ACTIVE_LAYER",[])}}),xe.StringConverterManager=a.Class({name:"StringConverterManager",oConverters:null,$init:function(){this.oConverters={}},$BEFORE_MSG_APP_READY:function(){this.oApp.exec("ADD_APP_PROPERTY",["applyConverter",a.fnBind(this.applyConverter,this)]),this.oApp.exec("ADD_APP_PROPERTY",["addConverter",a.fnBind(this.addConverter,this)])},applyConverter:function(a,b){var c=this.oConverters[a];if(!c)return b;for(var d=0;d<c.length;d++)b=c[d](b);return b},addConverter:function(a,b){var c=this.oConverters[a];c||(this.oConverters[a]=[]),this.oConverters[a][this.oConverters[a].length]=b}}),xe.MessageManager=a.Class({name:"MessageManager",oMessageMap:null,$init:function(a){this.oMessageMap=a},$BEFORE_MSG_APP_READY:function(){this.oApp.exec("ADD_APP_PROPERTY",["$MSG",a.fnBind(this.getMessage,this)])},getMessage:function(a){return this.oMessageMap[a]?unescape(this.oMessageMap[a]):a}}),xe.XE_Toolbar=a.Class({name:"XE_Toolbar",toolbarArea:null,toolbarButton:null,uiNameTag:"uiName",sUIClassPrefix:"xpress_xeditor_ui_",aUICmdMap:null,$init:function(a){this.htUIList={},this.aUICmdMap={},this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){b=a.$(b)||document,this.toolbarArea=a(".tool",b).get(0),this.welToolbarArea=a(this.toolbarArea),this.aAllButtons=a("BUTTON",this.toolbarArea).get();for(var c=this.toolbarArea.getElementsByTagName("LI"),d=c.length,e=new RegExp(this.sUIClassPrefix+"([^ ]+)"),f=0;d>f;f++)if(e.test(c[f].className)){var g=RegExp.$1;if(null!=this.htUIList[g])continue;this.htUIList[g]=a(">*:first-child",c[f]).get(0)}},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.toolbarArea,"mouseover","EVENT_TOOLBAR_MOUSEOVER",[]),this.oApp.registerBrowserEvent(this.toolbarArea,"mouseout","EVENT_TOOLBAR_MOUSEOUT",[]),this.oApp.exec("ADD_APP_PROPERTY",["getToolbarButtonByUIName",a.fnBind(this.getToolbarButtonByUIName,this)])},$ON_EVENT_TOOLBAR_MOUSEOVER:function(b){"BUTTON"==b.target.tagName&&a(b.target).addClass("hover").parent("span").addClass("hover")},$ON_EVENT_TOOLBAR_MOUSEOUT:function(b){"BUTTON"==b.target.tagName&&a(b.target).removeClass("hover").parent("span").removeClass("hover")},$ON_TOGGLE_TOOLBAR_ACTIVE_LAYER:function(a,b,c,d,e,f){this.oApp.exec("TOGGLE_ACTIVE_LAYER",[a,"MSG_TOOLBAR_LAYER_SHOWN",[a,b,c,d],e,f])},$ON_MSG_TOOLBAR_LAYER_SHOWN:function(a,b,c,d){this.oApp.exec("POSITION_TOOLBAR_LAYER",[a,b]),c&&this.oApp.exec(c,d)},$ON_SHOW_TOOLBAR_ACTIVE_LAYER:function(a,b,c,d){this.oApp.exec("SHOW_ACTIVE_LAYER",[a,b,c]),this.oApp.exec("POSITION_TOOLBAR_LAYER",[a,d])},$ON_ENABLE_UI:function(b){var c=this.htUIList[b];if(c){a(c).removeClass("off"),c.disabled=!1;var d="";if(this.aUICmdMap[b])for(var e=0;e<this.aUICmdMap[b].length;e++)d=this.aUICmdMap[b][e],this.oApp.exec("ENABLE_COMMAND",[d])}},$ON_DISABLE_UI:function(b){var c=this.htUIList[b];if(c){a(c).addClass("off"),a(c).removeClass("hover").parent("span").removeClass("hover"),c.disabled=!0;var d="";if(this.aUICmdMap[b])for(var e=0;e<this.aUICmdMap[b].length;e++)d=this.aUICmdMap[b][e],this.oApp.exec("DISABLE_COMMAND",[d])}},$ON_SELECT_UI:function(b){var c=this.htUIList[b];c&&a(c).addClass("active")},$ON_DESELECT_UI:function(b){var c=this.htUIList[b];c&&a(c).removeClass("active")},$ON_ENABLE_ALL_UI:function(){var b;for(var b in this.htUIList)b&&this.oApp.exec("ENABLE_UI",[b]);a(this.toolbarArea).removeClass("off")},$ON_DISABLE_ALL_UI:function(){var b;for(var b in this.htUIList)b&&this.oApp.exec("DISABLE_UI",[b]);a(this.toolbarArea).addClass("off"),this.oApp.exec("HIDE_ACTIVE_LAYER",[])},$ON_MSG_STYLE_CHANGED:function(a,b){1==b?this.oApp.exec("SELECT_UI",[a]):this.oApp.exec("DESELECT_UI",[a])},$ON_REGISTER_UI_EVENT:function(a,b,c,d){this.aUICmdMap[a]||(this.aUICmdMap[a]=[]),this.aUICmdMap[a][this.aUICmdMap[a].length]=c;var e=this.htUIList[a];e&&this.oApp.registerBrowserEvent(e,b,c,d)},$ON_POSITION_TOOLBAR_LAYER:function(b,c){if(b=a.$(b),c=a.$(c),b){c&&c.tagName&&"BUTTON"==c.tagName&&c.parentNode.appendChild(b),b.style.left="0";var d=a(b),e=d.offset().left;e+=b.offsetWidth;var f=this.welToolbarArea.offset().left;f+=this.toolbarArea.offsetWidth,e>f&&(b.style.left=f-e-5+"px")}},getToolbarButtonByUIName:function(a){return this.htUIList[a]}}),xe.XE_EditingAreaManager=a.Class({name:"XE_EditingAreaManager",oActivePlugin:null,oIRField:null,bIsDirty:!1,$init:function(b,c,d,e,f){this.sInitialMode=b,this.oIRField=a.$(c),this._assignHTMLObjects(f),this.fOnBeforeUnload=e,this.oEditingMode={},this.elEditingAreaContainer.style.height=parseInt(d.nHeight||this.elEditingAreaContainer.offsetHeight)+"px",this.nMinHeight=d.nMinHeight||10,this.niMinWidth=d.nMinWidth||10},_assignHTMLObjects:function(b){b=a.$(b)||document,this.elEditingAreaContainer=a("DIV.xpress_xeditor_editing_area_container",b).get(0),this.elEditingAreaSkipUI=a("A.skip",b).get(0)},$BEFORE_MSG_APP_READY:function(b){this.oApp.exec("ADD_APP_PROPERTY",["elEditingAreaContainer",this.elEditingAreaContainer]),this.oApp.exec("ADD_APP_PROPERTY",["getIR",a.fnBind(this.getIR,this)]),this.oApp.exec("ADD_APP_PROPERTY",["setIR",this.setIR]),this.oApp.exec("ADD_APP_PROPERTY",["getEditingMode",a.fnBind(this.getEditingMode,this)])},$ON_MSG_APP_READY:function(){this.oApp.exec("CHANGE_EDITING_MODE",[this.sInitialMode,!0]),this.oApp.exec("LOAD_IR_FIELD",[!1]),this.oApp.registerBrowserEvent(this.elEditingAreaSkipUI,"focus","MSG_EDITING_AREA_SIZE_CHANGED",[],50),this.oApp.registerBrowserEvent(this.elEditingAreaSkipUI,"blur","MSG_EDITING_AREA_SIZE_CHANGED",[],50)},$AFTER_MSG_APP_READY:function(){this.oApp.exec("UPDATE_IR_FIELD",[])},$ON_LOAD_IR_FIELD:function(a){this.oApp.setIR(this.oIRField.value,a)},$ON_UPDATE_IR_FIELD:function(){this.oIRField.value=this.oApp.getIR()},$BEFORE_CHANGE_EDITING_MODE:function(a){this._oPrevActivePlugin=this.oActivePlugin,this.oActivePlugin=this.oEditingMode[a]},$AFTER_CHANGE_EDITING_MODE:function(a,b){if(this._oPrevActivePlugin){var c=this._oPrevActivePlugin.getIR();this.oApp.exec("SET_IR",[c]),this.oApp.exec("ENABLE_UI",[this._oPrevActivePlugin.sMode]),this._setEditingAreaDimension()}this.oApp.exec("DISABLE_UI",[this.oActivePlugin.sMode]),b||this.oApp.exec("FOCUS",[])},$ON_SET_IS_DIRTY:function(a){this.bIsDirty=a},$ON_FOCUS:function(){this.oActivePlugin&&"function"==typeof this.oActivePlugin.setIR&&this.oActivePlugin.focus()},$BEFORE_SET_IR:function(a,b){b=b||!1,b||this.oApp.exec("RECORD_UNDO_ACTION",["SET CONTENTS"])},$ON_SET_IR:function(a){this.oActivePlugin&&"function"==typeof this.oActivePlugin.setIR&&this.oActivePlugin.setIR(a)},$AFTER_SET_IR:function(a,b){b=b||!1,b||this.oApp.exec("RECORD_UNDO_ACTION",["SET CONTENTS"])},$ON_REGISTER_EDITING_AREA:function(a){this.oEditingMode[a.sMode]=a,this.attachDocumentEvents(a.oEditingArea)},$ON_MSG_EDITING_AREA_RESIZE_STARTED:function(){this.oActivePlugin.elEditingArea.style.display="none",this.iStartingHeight=parseInt(this.elEditingAreaContainer.style.height)},$ON_RESIZE_EDITING_AREA:function(a,b){var c=parseInt(a),d=parseInt(b);c<this.niMinWidth&&(c=this.niMinWidth),d<this.nMinHeight&&(d=this.nMinHeight),a&&(this.elEditingAreaContainer.style.width=c+"px"),b&&(this.elEditingAreaContainer.style.height=d+"px")},$ON_RESIZE_EDITING_AREA_BY:function(a,b){var c=parseInt(a),d=parseInt(b),e=this.elEditingAreaContainer.style.width?parseInt(this.elEditingAreaContainer.style.width)+c:null,f=this.elEditingAreaContainer.style.height?this.iStartingHeight+d:null;this.oApp.exec("RESIZE_EDITING_AREA",[e,f])},$ON_MSG_EDITING_AREA_RESIZE_ENDED:function(a,b,c){this.oActivePlugin.elEditingArea.style.display="block",this._setEditingAreaDimension()},_setEditingAreaDimension:function(){this.oActivePlugin.elEditingArea.style.height=this.elEditingAreaContainer.style.height,this.oActivePlugin.elEditingArea.style.width=this.elEditingAreaContainer.style.width},attachDocumentEvents:function(a){this.oApp.registerBrowserEvent(a,"click","EVENT_EDITING_AREA_CLICK"),this.oApp.registerBrowserEvent(a,"mousedown","EVENT_EDITING_AREA_MOUSEDOWN"),this.oApp.registerBrowserEvent(a,"mousemove","EVENT_EDITING_AREA_MOUSEMOVE"),this.oApp.registerBrowserEvent(a,"mouseup","EVENT_EDITING_AREA_MOUSEUP"),this.oApp.registerBrowserEvent(a,"keydown","EVENT_EDITING_AREA_KEYDOWN"),this.oApp.registerBrowserEvent(a,"keypress","EVENT_EDITING_AREA_KEYPRESS"),this.oApp.registerBrowserEvent(a,"keyup","EVENT_EDITING_AREA_KEYUP")},getIR:function(){return this.oActivePlugin.getIR()},setIR:function(a,b){this.oApp.exec("SET_IR",[a,b])},getEditingMode:function(){return this.oActivePlugin.sMode}}),xe.XE_EditingArea_HTMLSrc=a.Class({name:"XE_EditingArea_HTMLSrc",sMode:"HTMLSrc",textarea:null,$init:function(b){this.textarea=a.$(b),this.elEditingArea=this.textarea},$BEFORE_MSG_APP_READY:function(){this.oEditingArea=this.textarea,this.oApp.exec("REGISTER_EDITING_AREA",[this])},$ON_CHANGE_EDITING_MODE:function(a,b){a==this.sMode?this.textarea.style.display="block":this.textarea.style.display="none"},$ON_PASTE_HTML:function(a,b){if(this.oApp.getEditingMode()==this.sMode){var d=new c(this.textarea);d.paste(a),this.textarea.focus()}},getIR:function(){var a,b=this.textarea.value;return a=this.oApp.applyConverter?this.oApp.applyConverter(this.sMode+"_TO_IR",b):b},setIR:function(a){var b;b=this.oApp.applyConverter?this.oApp.applyConverter("IR_TO_"+this.sMode,a):a,this.textarea.value=b},focus:function(){this.textarea.focus()}});var c=function(a){this._o=a};c.prototype.getSelection=function(){var a=this._o,b=[-1,-1];if(isNaN(this._o.selectionStart)){a.focus();var c=document.body.createTextRange(),d=null;d=document.selection.createRange().duplicate(),c.moveToElementText(a),d.collapse(!0),c.setEndPoint("EndToEnd",d),b[0]=c.text.length,d=document.selection.createRange().duplicate(),c.moveToElementText(a),d.collapse(!1),c.setEndPoint("EndToEnd",d),b[1]=c.text.length,a.blur()}else b[0]=a.selectionStart,b[1]=a.selectionEnd;return b},c.prototype.setSelection=function(a,b){var c=this._o;if("undefined"==typeof b&&(b=a),c.setSelectionRange)c.setSelectionRange(a,b);else if(c.createTextRange){var d=c.createTextRange();d.collapse(!0),d.moveStart("character",a),d.moveEnd("character",b-a),d.select(),c.blur()}},c.prototype.copy=function(){var a=this.getSelection();return this._o.value.substring(a[0],a[1])},c.prototype.paste=function(a){var b=this._o,c=this.getSelection(),d=b.value,e=d.substr(0,c[0]),f=d.substr(c[1]);d=e+a+f,b.value=d;var g=0;if("undefined"==typeof document.body.style.maxHeight){var h=e.match(/\n/gi);g=null!=h?h.length:0}this.setSelection(c[0]+a.length-g)},c.prototype.cut=function(){var a=this.copy();return this.paste(""),a},xe.XE_EditingArea_WYSIWYG=a.Class({name:"XE_EditingArea_WYSIWYG",status:xe.PLUGIN_STATUS.NOT_READY,sMode:"WYSIWYG",iframe:null,doc:null,iLastUndoRecorded:0,iMinUndoInterval:3e3,_nIFrameReadyCount:50,$init:function(b){this.iframe=a.$(b),this.initIframe(),this.elEditingArea=b},$BEFORE_MSG_APP_READY:function(){this.oEditingArea=this.doc,this.oApp.exec("REGISTER_EDITING_AREA",[this]),this.oApp.exec("ADD_APP_PROPERTY",["getWYSIWYGWindow",a.fnBind(this.getWindow,this)]),this.oApp.exec("ADD_APP_PROPERTY",["getWYSIWYGDocument",a.fnBind(this.getDocument,this)])},$ON_MSG_APP_READY:function(){a.browser.msie&&(a(this.doc).unbind("keydown.ea").bind("keydown.ea",a.fnBind(function(a){"control"==this.doc.selection.type.toLowerCase()&&8==a.keyCode&&(this.oApp.exec("EXECCOMMAND",["delete",!1,!1]),a.preventDefault(),a.stopPropagation())},this)),a(this.doc.body).unbind("mousedown.ea").bind("mousedown.ea",a.fnBind(function(a){this._oIERange=null,this._bIERangeReset=!0},this)).unbind("beforedeactivate.ea").bind("beforedeactivate.ea",a.fnBind(function(a){if(!this._bIERangeReset){var b=this.getDocument().selection.createRange(0);b.parentElement&&b.parentElement()&&"INPUT"==b.parentElement().tagName?this._oIERange=this._oPrevIERange:this._oIERange=b}},this)).unbind("mouseup.ea").bind("mouseup.ea",a.fnBind(function(a){this._bIERangeReset=!1},this)))},$ON_CHANGE_EDITING_MODE:function(a,b){a==this.sMode?(this.iframe.style.display="block",this.oApp.exec("REFRESH_WYSIWYG",[]),this.oApp.exec("SET_EDITING_WINDOW",[this.getWindow()])):this.iframe.style.display="none"},$AFTER_CHANGE_EDITING_MODE:function(a,b){this._oIERange=null},$ON_REFRESH_WYSIWYG:function(){a.browser.mozilla&&(this._disableWYSIWYG(),this._enableWYSIWYG())},$ON_ENABLE_WYSIWYG:function(){this._enableWYSIWYG()},$ON_DISABLE_WYSIWYG:function(){this._disableWYSIWYG()},$ON_EVENT_EDITING_AREA_KEYDOWN:function(a){if(a.ctrlKey){switch(a.keyCode){case 37:this.oApp.exec("EXECCOMMAND",["outdent",!1,!1]);break;case 39:this.oApp.exec("EXECCOMMAND",["indent",!1,!1]);break;case 49:case 50:case 51:case 52:case 53:case 54:this.oApp.exec("EXECCOMMAND",["FormatBlock",!1,"<h"+(a.keyCode-48)+">"]);break;default:return}a.preventDefault(),a.stopPropagation()}},$ON_EVENT_EDITING_AREA_KEYUP:function(a){229==a.keyCode||13==a.keyCode||a.altKey||a.ctrlKey||a.keyCode>=33&&a.keyCode<=40||16==a.keyCode||this._recordUndo(a)},$ON_PASTE_HTML:function(b,c){if(this.oApp.getEditingMode()==this.sMode){var d=c||this.oApp.getSelection();if(d.pasteHTML(b),!a.browser.msie){var e=d.placeStringBookmark();this.oApp.getWYSIWYGDocument().body.innerHTML=this.oApp.getWYSIWYGDocument().body.innerHTML,d.moveToBookmark(e),d.collapseToEnd(),d.select(),d.removeStringBookmark(e)}this.oApp.exec("RECORD_UNDO_ACTION",["INSERT HTML"])}},$AFTER_MSG_EDITING_AREA_RESIZE_ENDED:function(a,b,c){this.oApp.exec("REFRESH_WYSIWYG",[])},$ON_RESTORE_IE_SELECTION:function(){this._oIERange&&(this._oIERange.select(),this._oPrevIERange=this._oIERange,this._oIERange=null)},initIframe:function(){try{if(this.doc=this.iframe.contentWindow.document,null==this.doc||"about:blank"==this.doc.location.href)throw new Error("Access denied");this._enableWYSIWYG(),this.status=xe.PLUGIN_STATUS.READY}catch(b){if(!(this._nIFrameReadyCount-- >0))throw"iframe for WYSIWYG editing mode can't be initialized. Please check if the iframe document exists and is also accessable(cross-domain issues). ";setTimeout(a.fnBind(this.initIframe,this),100)}},getIR:function(){var a,b=this.doc.body.innerHTML;return a=this.oApp.applyConverter?this.oApp.applyConverter(this.sMode+"_TO_IR",b):b},setIR:function(b){var c;c=this.oApp.applyConverter?this.oApp.applyConverter("IR_TO_"+this.sMode,b):b,this.doc.body.innerHTML=c,a.browser.mozilla&&""==this.doc.body.innerHTML&&(this.doc.body.innerHTML="<br>")},getWindow:function(){return this.iframe.contentWindow},getDocument:function(){return this.iframe.contentWindow.document},focus:function(){},_recordUndo:function(a){var b=new Date;b-this.iLastUndoRecorded<this.iMinUndoInterval||(this.oApp.exec("RECORD_UNDO_ACTION",["KEYPRESS"]),this.iLastUndoRecorded=new Date,this.prevKeyCode=a.keyCode)},_enableWYSIWYG:function(){a.browser.msie?(this.doc.body.disabled=!0,this.doc.body.contentEditable=!0,this.doc.body.removeAttribute("disabled")):this.doc.designMode="on"},_disableWYSIWYG:function(){a.browser.msie?this.doc.body.contentEditable=!1:this.doc.designMode="off"}}),xe.XE_EditingAreaVerticalResizer=a.Class({name:"XE_EditingAreaVerticalResizer",oResizeGrip:null,$init:function(b){this._assignHTMLObjects(b),this.$FnMouseDown=a.fnBind(this._mousedown,this),this.$FnMouseMove=a.fnBind(this._mousemove,this),this.$FnMouseUp=a.fnBind(this._mouseup,this),a(this.oResizeGrip).bind("mousedown",this.$FnMouseDown)},_assignHTMLObjects:function(b){b=a.$(b)||document,this.oResizeGrip=a(".xpress_xeditor_editingArea_verticalResizer",b).get(0)},_mousedown:function(b){this.iStartHeight=b.clientY,a(document).bind("mousemove",this.$FnMouseMove),a(document).bind("mouseup",this.$FnMouseUp),this.oApp.exec("MSG_EDITING_AREA_RESIZE_STARTED",[this.$FnMouseDown,this.$FnMouseMove,this.$FnMouseUp])},_mousemove:function(a){var b=a.clientY-this.iStartHeight;this.oApp.exec("RESIZE_EDITING_AREA_BY",[0,b])},_mouseup:function(b){a(document).unbind("mousemove",this.$FnMouseMove),a(document).unbind("mouseup",this.$FnMouseUp),this.oApp.exec("MSG_EDITING_AREA_RESIZE_ENDED",[this.$FnMouseDown,this.$FnMouseMove,this.$FnMouseUp])}}),xe.XE_ExecCommand=a.Class({name:"XE_ExecCommand",oEditingArea:null,$init:function(a){this.oEditingArea=a},$BEFORE_MSG_APP_READY:function(){this.oEditingArea&&"IFRAME"==this.oEditingArea.tagName&&(this.oEditingArea=this.oEditingArea.contentWindow.document)},$ON_MSG_APP_READY:function(){this.oApp.exec("REGISTER_HOTKEY",["ctrl+b","EXECCOMMAND",["bold",!1,!1]]),this.oApp.exec("REGISTER_HOTKEY",["ctrl+u","EXECCOMMAND",["underline",!1,!1]]),this.oApp.exec("REGISTER_HOTKEY",["ctrl+i","EXECCOMMAND",["italic",!1,!1]]),this.oApp.exec("REGISTER_HOTKEY",["ctrl+d","EXECCOMMAND",["strikethrough",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["bold","click","EXECCOMMAND",["bold",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["underline","click","EXECCOMMAND",["underline",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["italic","click","EXECCOMMAND",["italic",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["lineThrough","click","EXECCOMMAND",["strikethrough",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["superscript","click","EXECCOMMAND",["superscript",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["subscript","click","EXECCOMMAND",["subscript",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["justifyleft","click","EXECCOMMAND",["justifyleft",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["justifycenter","click","EXECCOMMAND",["justifycenter",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["justifyright","click","EXECCOMMAND",["justifyright",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["justifyfull","click","EXECCOMMAND",["justifyfull",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["orderedlist","click","EXECCOMMAND",["insertorderedlist",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["unorderedlist","click","EXECCOMMAND",["insertunorderedlist",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["outdent","click","EXECCOMMAND",["outdent",!1,!1]]),this.oApp.exec("REGISTER_UI_EVENT",["indent","click","EXECCOMMAND",["indent",!1,!1]])},$BEFORE_EXECCOMMAND:function(a,b,c){if(this._bOnlyCursorChanged=!1,this.oApp.exec("FOCUS",[]),a.match(/^bold|underline|italic|strikethrough|superscript|subscript$/i)){var d=this.oApp.getSelection();d.collapsed&&(this._bOnlyCursorChanged=!0)}this._bOnlyCursorChanged||this.oApp.exec("RECORD_UNDO_BEFORE_ACTION",[a])},$ON_EXECCOMMAND:function(a,b,c){b=""==b||b?b:!1,c=""==c||c?c:!1,this.oEditingArea.execCommand(a,b,c)},$AFTER_EXECCOMMAND:function(a,b,c){this._bOnlyCursorChanged||this.oApp.exec("RECORD_UNDO_AFTER_ACTION",[a]),this.oApp.exec("CHECK_STYLE_CHANGE",[])}}),xe.XE_WYSIWYGEnterKey=a.Class({name:"XE_WYSIWYGEnterKey",unsupportedBrowser:["ie","opera"],oEditingArea:null,$init:function(a){this.oEditingArea=a},$BEFORE_MSG_APP_READY:function(){this.oEditingArea&&"IFRAME"==this.oEditingArea.tagName&&(this.oEditingArea=this.oEditingArea.contentWindow.document)},$ON_EVENT_EDITING_AREA_KEYDOWN:function(a){if("WYSIWYG"==this.oApp.getEditingMode()&&!a.shiftKey&&13==a.keyCode){var b=this.oApp.getSelection(),c=b.placeStringBookmark(),d=b.getLineInfo(),e=d.oStart,f=d.oEnd;if(!e.bParentBreak||b.rxBlockContainer.test(e.oLineBreaker.tagName)){a.stopPropagation(),a.preventDefault();var g=this.oEditingArea.createElement("P");b.moveToBookmark(c),b.setStartBefore(e.oNode),b.surroundContents(g),b.collapseToEnd();var h=this.oEditingArea.createElement("P");b.setEndAfter(f.oNode),b.surroundContents(h),b.removeStringBookmark(c),""==g.innerHTML&&(g.innerHTML="<br>"),""==h.innerHTML&&(h.innerHTML="<br>"),h.nextSibling&&"BR"==h.nextSibling.tagName&&h.parentNode.removeChild(h.nextSibling),b.selectNodeContents(h),b.collapseToStart(),b.select(),this.oApp.exec("CHECK_STYLE_CHANGE",[])}else b.removeStringBookmark(c)}}}),xe.XE_WYSIWYGStyler=a.Class({name:"XE_WYSIWYGStyler",$PRECONDITION:function(a,b){return"WYSIWYG"==this.oApp.getEditingMode()},$ON_SET_WYSIWYG_STYLE:function(b){var c=this.oApp.getSelection();if(c.collapsed){var d=this.oApp.getWYSIWYGDocument().createElement("SPAN");c.insertNode(d),d.innerHTML=unescape("%uFEFF");var e;for(var f in b)e=b[f],"string"==typeof e&&(d.style[f]=e);return c.selectNodeContents(d),c.collapseToEnd(),c._window.focus(),c._window.document.body.focus(),c.select(),void(a.browser.mozilla&&3==a.browser.nVersion&&(d.innerHTML=""))}this.oApp.exec("RECORD_UNDO_BEFORE_ACTION",["FONT STYLE"]),c.styleRange(b),c._window.focus(),c.select(),this.oApp.exec("RECORD_UNDO_AFTER_ACTION",["FONT STYLE"])}}),xe.XE_WYSIWYGStyleGetter=a.Class({name:"XE_WYSIWYGStyleGetter",hKeyUp:null,getStyleInterval:200,oStyleMap:{fontFamily:{type:"Value",css:"fontFamily"},fontSize:{type:"Value",css:"fontSize"},lineHeight:{type:"Value",css:"lineHeight",converter:function(a,b){return a.match(/px$/)?Math.ceil(parseInt(a)/parseInt(b.fontSize)*10)/10:a}},bold:{command:"bold"},underline:{command:"underline"},italic:{command:"italic"},lineThrough:{command:"strikethrough"},superscript:{command:"superscript"},subscript:{command:"subscript"},justifyleft:{command:"justifyleft"},justifycenter:{command:"justifycenter"},justifyright:{command:"justifyright"},justifyfull:{command:"justifyfull"},orderedlist:{command:"insertorderedlist"},unorderedlist:{command:"insertunorderedlist"}},$init:function(){this.oStyle=this._getBlankStyle()},$PRECONDITION:function(){return"WYSIWYG"==this.oApp.getEditingMode()},$ON_MSG_APP_READY:function(){this.oDocument=this.oApp.getWYSIWYGDocument(),this.oApp.exec("ADD_APP_PROPERTY",["getCurrentStyle",a.fnBind(this.getCurrentStyle,this)])},$ON_EVENT_EDITING_AREA_MOUSEUP:function(a){this.hKeyUp&&clearTimeout(this.hKeyUp),this.oApp.exec("CHECK_STYLE_CHANGE",[])},$ON_EVENT_EDITING_AREA_KEYUP:function(b){(8==b.keyCode||b.keyCode>=33&&b.keyCode<=40||45==b.keyCode||46==b.keyCode)&&(this.hKeyUp&&clearTimeout(this.hKeyUp),this.hKeyUp=setTimeout(a.fnBind(this.oApp.exec,this.oApp,"CHECK_STYLE_CHANGE",[]),this.getStyleInterval))},$ON_CHECK_STYLE_CHANGE:function(){this._getStyle()},$ON_RESET_STYLE_STATUS:function(){var a=this._getBlankStyle();for(var b in a)this.oApp.exec("SET_STYLE_STATUS",[b,a[b]])},getCurrentStyle:function(){return this.oStyle},_check_style_change:function(){this.oApp.exec("CHECK_STYLE_CHANGE",[])},_getBlankStyle:function(){var a={};
for(var b in this.oStyleMap)"Value"==this.oStyleMap[b].type?a[b]="":a[b]=0;return a},_getStyle:function(){var a,b,c=this.oApp.getSelection(),d=function(a){return!a.childNodes||0==a.childNodes.length},e=c.getNodes(!1,d);a=0==e.length?this._getStyleOf(c.commonAncestorContainer):this._getStyleOf(e[0]);for(b in a)this.oStyleMap[b].converter&&(a[b]=this.oStyleMap[b].converter(a[b],a)),this.oStyle[b]!=a[b]&&this.oApp.exec("MSG_STYLE_CHANGED",[b,a[b]]);this.oStyle=a},_getStyleOf:function(b){var c=this._getBlankStyle();if(!b)return c;3==b.nodeType&&(b=b.parentNode);var d,e=a(b);for(var f in this.oStyle)if(d=this.oStyleMap[f],d.type&&"Value"==d.type){if(d.css){var g=e.css(d.css);"fontFamily"==f&&(g=g.split(/,/)[0]),c[f]=g}else if(d.command)try{c[f]=this.oDocument.queryCommandState(d.command)}catch(h){}}else if(d.command)try{this.oDocument.queryCommandState(d.command)?c[f]=1:c[f]=0}catch(h){}return c}}),xe.XE_FontSizeWithSelectUI=a.Class({name:"XE_FontSizeWithSelectUI",$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elFontSizeSelect=a("SELECT.xpress_xeditor_ui_fontSize_select",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elFontSizeSelect,"change","SET_FONTSIZE_FROM_SELECT_UI"),this.elFontSizeSelect.selectedIndex=0},$ON_MSG_STYLE_CHANGED:function(a,b){"fontSize"==a&&(this.elFontSizeSelect.value=b,this.elFontSizeSelect.selectedIndex<0&&(this.elFontSizeSelect.selectedIndex=0))},$ON_SET_FONTSIZE_FROM_SELECT_UI:function(){var a=this.elFontSizeSelect.value;a&&(this.oApp.exec("SET_WYSIWYG_STYLE",[{fontSize:a}]),this.oApp.exec("CHECK_STYLE_CHANGE",[]))}}),xe.XE_FontNameWithSelectUI=a.Class({name:"XE_FontNameWithSelectUI",$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elFontNameSelect=a("SELECT.xpress_xeditor_ui_fontName_select",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elFontNameSelect,"change","SET_FONTNAME_FROM_SELECT_UI"),this.elFontNameSelect.selectedIndex=0},$ON_MSG_STYLE_CHANGED:function(a,b){"fontFamily"==a&&(this.elFontNameSelect.value=b.toLowerCase(),this.elFontNameSelect.selectedIndex<0&&(this.elFontNameSelect.selectedIndex=0))},$ON_SET_FONTNAME_FROM_SELECT_UI:function(){var a=this.elFontNameSelect.value;a&&(this.oApp.exec("SET_WYSIWYG_STYLE",[{fontFamily:a}]),this.oApp.exec("CHECK_STYLE_CHANGE",[]))}}),xe.XE_LineHeight=a.Class({name:"XE_LineHeight",$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(a){},$ON_SET_LINEHEIGHT:function(a){this.setLineHeight(a)},getLineHeight:function(){var b,c,d,e=this._getSelectedNodes(!1);if(0==e.length)return-1;var f=e.length;0==f?d=-1:(c=this._getLineWrapper(e[0]),d=this._getWrapperLineheight(c));var g=this.oSelection.getStartNode();if(d>0)for(var h=1;f>h;h++)if(!this._isChildOf(e[h],b)&&e[h]&&(b=this._getLineWrapper(e[h]),b!=c)){if(curHeight=this._getWrapperLineheight(b),curHeight!=d){d=-1;break}c=b}b=this._getLineWrapper(e[f-1]);var i=this.oSelection.getEndNode();return selectText=a.fnBind(function(a,b){this.oSelection.setEndNodes(a,b),this.oSelection.select()},this,g,i),setTimeout(selectText,100),d},setLineHeight:function(b){function c(a,b){if(!a)try{a=thisRef.oSelection.surroundContentsWithNewNode("P")}catch(c){a=thisRef.oSelection.surroundContentsWithNewNode("DIV")}return a.style.lineHeight=b,a}function d(a){for(;a&&"BODY"!=a.tagName;)a=xe.DOMFix.parentNode(a);return!!a}thisRef=this;var e=this._getSelectedNodes(!1);if(0!=e.length){var f,g,h=e.length;this.oApp.exec("RECORD_UNDO_BEFORE_ACTION",["LINEHEIGHT"]),g=this._getLineWrapper(e[0]),g=c(g,b);for(var i=g,j=g,k=1;h>k;k++){try{if(!d(xe.DOMFix.parentNode(e[k])))continue}catch(l){continue}this._isChildOf(e[k],f)||(f=this._getLineWrapper(e[k]),f!=g&&(f=c(f,b),g=f))}j=f||i,setTimeout(a.fnBind(function(a,b){this.oSelection.setEndNodes(a,b),this.oSelection.select(),this.oApp.exec("RECORD_UNDO_AFTER_ACTION",["LINEHEIGHT"])},this,i,j),100)}},_getSelectedNodes:function(a){a||(this.oSelection=this.oApp.getSelection()),this.oSelection.collapsed&&this.oSelection.selectNode(this.oSelection.commonAncestorContainer);var b=this.oSelection.getTextNodes();if(0==b.length){var c=this.oSelection.getStartNode();c?b[0]=c:b=[]}return b},_getWrapperLineheight:function(a){var b="";if(a&&a.style.lineHeight)b=a.style.lineHeight;else for(a=this.oSelection.commonAncesterContainer;a&&!this.oSelection.rxLineBreaker.test(a.tagName);){if(a&&a.style.lineHeight){b=a.style.lineHeight;break}a=xe.DOMFix.parentNode(a)}return b},_isChildOf:function(a,b){for(;a&&"BODY"!=a.tagName;){if(a==b)return!0;a=xe.DOMFix.parentNode(a)}return!1},_getLineWrapper:function(a){var b=this.oApp.getEmptySelection();b.selectNode(a);var c,d,e,f,g=b.getLineInfo(),h=g.oStart,i=g.oEnd,j=null;return c=h.oNode,e=h.oLineBreaker,d=i.oNode,f=i.oLineBreaker,this.oSelection.setEndNodes(c,d),e==f&&("P"==e.tagName||"DIV"==e.tagName?j=e:this.oSelection.setEndNodes(e.firstChild,e.lastChild)),j}}),xe.XE_LineHeightWithSelectUI=a.Class({name:"XE_LineHeightWithSelectUI",_assignHTMLObjects:function(b){this.elLineHeightSelect=a("SELECT.xpress_xeditor_ui_lineHeight_select",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elLineHeightSelect,"change","SET_LINEHEIGHT_FROM_SELECT_UI"),this.elLineHeightSelect.selectedIndex=0},$ON_MSG_STYLE_CHANGED:function(a,b){"lineHeight"==a&&(this.elLineHeightSelect.value=b,this.elLineHeightSelect.selectedIndex<0&&(this.elLineHeightSelect.selectedIndex=0))},$ON_SET_LINEHEIGHT_FROM_SELECT_UI:function(){var a=this.elLineHeightSelect.value;a&&(this.elLineHeightSelect.selectedIndex=0,this.oApp.exec("SET_LINEHEIGHT",[a]),this.oApp.exec("CHECK_STYLE_CHANGE",[]))}}).extend(xe.XE_LineHeight),xe.XE_ColorPalette=a.Class({name:"XE_ColorPalette",rxRGBColorPattern:/rgb\((\d+), ?(\d+), ?(\d+)\)/i,$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elColorPaletteLayer=a("UL.xpress_xeditor_color_palette",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elColorPaletteLayer,"click","EVENT_MOUSEUP_COLOR_PALETTE")},$ON_SHOW_COLOR_PALETTE:function(a,b){this.sCallbackCmd=a,this.oLayerContainer=b,this.oLayerContainer.insertBefore(this.elColorPaletteLayer,null),this.elColorPaletteLayer.style.display="block"},$ON_HIDE_COLOR_PALETTE:function(){this.elColorPaletteLayer.style.display="none"},$ON_COLOR_PALETTE_APPLY_COLOR:function(a){function b(a){var b=parseInt(a).toString(16);return b.length<2&&(b="0"+b),b.toUpperCase()}if(this.rxRGBColorPattern.test(a)){var c=b(RegExp.$1),d=b(RegExp.$2),e=b(RegExp.$3);a="#"+c+d+e}this.oApp.exec(this.sCallbackCmd,[a])},$ON_EVENT_MOUSEUP_COLOR_PALETTE:function(a){var b=a.target;b.style.backgroundColor&&this.oApp.exec("COLOR_PALETTE_APPLY_COLOR",[b.style.backgroundColor])}}),xe.XE_FontColor=a.Class({name:"XE_FontColor",rxColorPattern:/^#?[0-9a-fA-F]{6}$|^rgb\(\d+, ?\d+, ?\d+\)$/i,$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elDropdownLayer=a("DIV.xpress_xeditor_fontcolor_layer",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.exec("REGISTER_UI_EVENT",["fontColor","click","TOGGLE_FONTCOLOR_LAYER"])},$ON_TOGGLE_FONTCOLOR_LAYER:function(){this.oApp.exec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.elDropdownLayer,null,"SHOW_COLOR_PALETTE",["APPLY_FONTCOLOR",this.elDropdownLayer]])},$ON_APPLY_FONTCOLOR:function(a){return this.rxColorPattern.test(a)?(this.oApp.exec("SET_WYSIWYG_STYLE",[{color:a}]),void this.oApp.exec("HIDE_ACTIVE_LAYER")):void alert(this.oApp.$MSG("XE_FontColor.invalidColorCode"))}}),xe.XE_BGColor=a.Class({name:"XE_BGColor",rxColorPattern:/^#?[0-9a-fA-F]{6}$|^rgb\(\d+, ?\d+, ?\d+\)$/i,$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elDropdownLayer=a("DIV.xpress_xeditor_bgcolor_layer",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.exec("REGISTER_UI_EVENT",["bgColor","click","TOGGLE_BGCOLOR_LAYER"]),this.oApp.registerBrowserEvent(this.elDropdownLayer,"click","EVENT_APPLY_BGCOLOR",[])},$ON_TOGGLE_BGCOLOR_LAYER:function(){this.oApp.exec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.elDropdownLayer,null,"SHOW_COLOR_PALETTE",["APPLY_BGCOLOR",this.elDropdownLayer]])},$ON_EVENT_APPLY_BGCOLOR:function(a){var b=a.target;if("SPAN"==b.tagName&&(b=b.parentNode),"BUTTON"==b.tagName){var c,d;c=b.style.backgroundColor,d=b.style.color,this.oApp.exec("APPLY_BGCOLOR",[c,d])}},$ON_APPLY_BGCOLOR:function(a,b){if(!this.rxColorPattern.test(a))return void alert(this.oApp.$MSG("XE_BGColor.invalidColorCode"));var c={backgroundColor:a};b&&(c.color=b),this.oApp.exec("SET_WYSIWYG_STYLE",[c]),this.oApp.exec("HIDE_ACTIVE_LAYER")}}),xe.XE_Quote=a.Class({name:"XE_Quote",$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elDropdownLayer=a("DIV.xpress_xeditor_blockquote_layer",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.exec("REGISTER_UI_EVENT",["quote","click","TOGGLE_BLOCKQUOTE_LAYER"]),this.oApp.registerBrowserEvent(this.elDropdownLayer,"click","EVENT_APPLY_SEDITOR_BLOCKQUOTE",[])},$ON_TOGGLE_BLOCKQUOTE_LAYER:function(){this.oApp.exec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.elDropdownLayer])},$ON_EVENT_APPLY_SEDITOR_BLOCKQUOTE:function(a){var b=a.target;if("BUTTON"==b.tagName){var c=b.parentNode.className;"q8"!=c?this._wrapBlock("BLOCKQUOTE",c):this._unwrapBlock("BLOCKQUOTE"),this.oApp.exec("HIDE_ACTIVE_LAYER",[])}},_unwrapBlock:function(a){for(var b=this.oApp.getSelection(),c=b.commonAncestorContainer;c&&c.tagName!=a;)c=c.parentNode;if(c){for(;c.firstChild;)c.parentNode.insertBefore(c.firstChild,c);c.parentNode.removeChild(c)}},_wrapBlock:function(a,b){var c,d,e=this.oApp.getSelection(),f=e.getLineInfo(),g=f.oStart,h=f.oEnd,i=/BODY|TD|LI/i;c=g.bParentBreak&&!i.test(g.oLineBreaker.tagName)?g.oNode.parentNode:g.oNode,d=h.bParentBreak&&!i.test(h.oLineBreaker.tagName)?h.oNode.parentNode:h.oNode,e.setStartBefore(c),e.setEndAfter(d);var j=this._expandToTableStart(e,d);j&&(d=j,e.setEndAfter(j)),j=this._expandToTableStart(e,c),j&&(c=j,e.setStartBefore(j)),j=c;for(var k=e.commonAncestorContainer;j&&j!=k&&j.parentNode!=k;)j=j.parentNode;oFormattingNode=e._document.createElement(a),b&&(oFormattingNode.className=b),j==k?k.insertBefore(oFormattingNode,k.firstChild):k.insertBefore(oFormattingNode,j),e.setStartAfter(oFormattingNode),e.setEndAfter(d),e.surroundContents(oFormattingNode);for(var l,m=oFormattingNode.childNodes,n=m.length-1;n>=0;n--)if(3==m[n].nodeType||"BR"==m[n].tagName){var o=e._document.createElement("P");for(l=m[n].nextSibling;n>=0&&m[n]&&(3==m[n].nodeType||"BR"==m[n].tagName);)o.insertBefore(m[n--],o.firstChild);oFormattingNode.insertBefore(o,l),n++}if(oFormattingNode&&oFormattingNode.parentNode){var o=e._document.createElement("P");o.innerHTML=unescape("<br/>"),oFormattingNode.parentNode.insertBefore(o,oFormattingNode.nextSibling)}return this.oApp.exec("RECORD_UNDO_ACTION",["Block Quote"]),oFormattingNode},_expandToTableStart:function(a,b){for(var c=a.commonAncestorContainer,d=null,e=!1;b&&!e;){if(b==c&&(e=!0),/TBODY|TFOOT|THEAD|TR/i.test(b.tagName)){d=this._getTableRoot(b);break}b=b.parentNode}return d},_getTableRoot:function(a){for(;a&&"TABLE"!=a.tagName;)a=a.parentNode;return a}}),xe.XE_SCharacter=a.Class({name:"XE_SCharacter",$init:function(b){this.bIE=a.browser.msie,this._assignHTMLObjects(b),this.charSet=[],this.charSet[0]=unescape("FF5B FF5D 3014 3015 3008 3009 300A 300B 300C 300D 300E 300F 3010 3011 2018 2019 201C 201D 3001 3002 %B7 2025 2026 %A7 203B 2606 2605 25CB 25CF 25CE 25C7 25C6 25A1 25A0 25B3 25B2 25BD 25BC 25C1 25C0 25B7 25B6 2664 2660 2661 2665 2667 2663 2299 25C8 25A3 25D0 25D1 2592 25A4 25A5 25A8 25A7 25A6 25A9 %B1 %D7 %F7 2260 2264 2265 221E 2234 %B0 2032 2033 2220 22A5 2312 2202 2261 2252 226A 226B 221A 223D 221D 2235 222B 222C 2208 220B 2286 2287 2282 2283 222A 2229 2227 2228 FFE2 21D2 21D4 2200 2203 %B4 FF5E 02C7 02D8 02DD 02DA 02D9 %B8 02DB %A1 %BF 02D0 222E 2211 220F 266D 2669 266A 266C 327F 2192 2190 2191 2193 2194 2195 2197 2199 2196 2198 321C 2116 33C7 2122 33C2 33D8 2121 2668 260F 260E 261C 261E %B6 2020 2021 %AE %AA %BA 2642 2640").replace(/(\S{4})/g,function(a){return"%u"+a}).split(" "),this.charSet[1]=unescape("%BD 2153 2154 %BC %BE 215B 215C 215D 215E %B9 %B2 %B3 2074 207F 2081 2082 2083 2084 2160 2161 2162 2163 2164 2165 2166 2167 2168 2169 2170 2171 2172 2173 2174 2175 2176 2177 2178 2179 FFE6 %24 FFE5 FFE1 20AC 2103 212B 2109 FFE0 %A4 2030 3395 3396 3397 2113 3398 33C4 33A3 33A4 33A5 33A6 3399 339A 339B 339C 339D 339E 339F 33A0 33A1 33A2 33CA 338D 338E 338F 33CF 3388 3389 33C8 33A7 33A8 33B0 33B1 33B2 33B3 33B4 33B5 33B6 33B7 33B8 33B9 3380 3381 3382 3383 3384 33BA 33BB 33BC 33BD 33BE 33BF 3390 3391 3392 3393 3394 2126 33C0 33C1 338A 338B 338C 33D6 33C5 33AD 33AE 33AF 33DB 33A9 33AA 33AB 33AC 33DD 33D0 33D3 33C3 33C9 33DC 33C6").replace(/(\S{4})/g,function(a){return"%u"+a}).split(" "),this.charSet[2]=unescape("3260 3261 3262 3263 3264 3265 3266 3267 3268 3269 326A 326B 326C 326D 326E 326F 3270 3271 3272 3273 3274 3275 3276 3277 3278 3279 327A 327B 24D0 24D1 24D2 24D3 24D4 24D5 24D6 24D7 24D8 24D9 24DA 24DB 24DC 24DD 24DE 24DF 24E0 24E1 24E2 24E3 24E4 24E5 24E6 24E7 24E8 24E9 2460 2461 2462 2463 2464 2465 2466 2467 2468 2469 246A 246B 246C 246D 246E 3200 3201 3202 3203 3204 3205 3206 3207 3208 3209 320A 320B 320C 320D 320E 320F 3210 3211 3212 3213 3214 3215 3216 3217 3218 3219 321A 321B 249C 249D 249E 249F 24A0 24A1 24A2 24A3 24A4 24A5 24A6 24A7 24A8 24A9 24AA 24AB 24AC 24AD 24AE 24AF 24B0 24B1 24B2 24B3 24B4 24B5 2474 2475 2476 2477 2478 2479 247A 247B 247C 247D 247E 247F 2480 2481 2482").replace(/(\S{4})/g,function(a){return"%u"+a}).split(" "),this.charSet[3]=unescape("3131 3132 3133 3134 3135 3136 3137 3138 3139 313A 313B 313C 313D 313E 313F 3140 3141 3142 3143 3144 3145 3146 3147 3148 3149 314A 314B 314C 314D 314E 314F 3150 3151 3152 3153 3154 3155 3156 3157 3158 3159 315A 315B 315C 315D 315E 315F 3160 3161 3162 3163 3165 3166 3167 3168 3169 316A 316B 316C 316D 316E 316F 3170 3171 3172 3173 3174 3175 3176 3177 3178 3179 317A 317B 317C 317D 317E 317F 3180 3181 3182 3183 3184 3185 3186 3187 3188 3189 318A 318B 318C 318D 318E").replace(/(\S{4})/g,function(a){return"%u"+a}).split(" "),this.charSet[4]=unescape("0391 0392 0393 0394 0395 0396 0397 0398 0399 039A 039B 039C 039D 039E 039F 03A0 03A1 03A3 03A4 03A5 03A6 03A7 03A8 03A9 03B1 03B2 03B3 03B4 03B5 03B6 03B7 03B8 03B9 03BA 03BB 03BC 03BD 03BE 03BF 03C0 03C1 03C3 03C4 03C5 03C6 03C7 03C8 03C9 %C6 %D0 0126 0132 013F 0141 %D8 0152 %DE 0166 014A %E6 0111 %F0 0127 I 0133 0138 0140 0142 0142 0153 %DF %FE 0167 014B 0149 0411 0413 0414 0401 0416 0417 0418 0419 041B 041F 0426 0427 0428 0429 042A 042B 042C 042D 042E 042F 0431 0432 0433 0434 0451 0436 0437 0438 0439 043B 043F 0444 0446 0447 0448 0449 044A 044B 044C 044D 044E 044F").replace(/(\S{4})/g,function(a){return"%u"+a}).split(" "),this.charSet[5]=unescape("3041 3042 3043 3044 3045 3046 3047 3048 3049 304A 304B 304C 304D 304E 304F 3050 3051 3052 3053 3054 3055 3056 3057 3058 3059 305A 305B 305C 305D 305E 305F 3060 3061 3062 3063 3064 3065 3066 3067 3068 3069 306A 306B 306C 306D 306E 306F 3070 3071 3072 3073 3074 3075 3076 3077 3078 3079 307A 307B 307C 307D 307E 307F 3080 3081 3082 3083 3084 3085 3086 3087 3088 3089 308A 308B 308C 308D 308E 308F 3090 3091 3092 3093 30A1 30A2 30A3 30A4 30A5 30A6 30A7 30A8 30A9 30AA 30AB 30AC 30AD 30AE 30AF 30B0 30B1 30B2 30B3 30B4 30B5 30B6 30B7 30B8 30B9 30BA 30BB 30BC 30BD 30BE 30BF 30C0 30C1 30C2 30C3 30C4 30C5 30C6 30C7 30C8 30C9 30CA 30CB 30CC 30CD 30CE 30CF 30D0 30D1 30D2 30D3 30D4 30D5 30D6 30D7 30D8 30D9 30DA 30DB 30DC 30DD 30DE 30DF 30E0 30E1 30E2 30E3 30E4 30E5 30E6 30E7 30E8 30E9 30EA 30EB 30EC 30ED 30EE 30EF 30F0 30F1 30F2 30F3 30F4 30F5 30F6").replace(/(\S{4})/g,function(a){return"%u"+a}).split(" ")},_assignHTMLObjects:function(b){b=a.$(b)||document,this.elDropdownLayer=a("DIV.xpress_xeditor_sCharacter_layer",b).get(0),this.oTextField=a("INPUT",this.elDropdownLayer).get(0),this.oInsertButton=a("+ BUTTON",this.oTextField).get(0),this.aCloseButton=a("BUTTON.close",this.elDropdownLayer).get(),this.aSCharList=a(".list",this.elDropdownLayer).get();var c=a(">UL",this.elDropdownLayer).get(0);this.aLabelA=a("A",c).get()},$ON_MSG_APP_READY:function(){var b=a.fnBind(this.oApp.exec,this.oApp,"INSERT_SCHARACTERS",[this.oTextField.value]);a(this.oInsertButton).click(b),this.oApp.exec("SET_SCHARACTER_LIST",[this.charSet]);for(var c=0;c<this.aLabelA.length;c++){var d=a.fnBind(this.oApp.exec,this.oApp,"CHANGE_SCHARACTER_SET",[c]);a(this.aLabelA[c]).mousedown(d),this._stopBrowserEvent(this.aLabelA[c],"click")}for(var c=0;c<this.aCloseButton.length;c++)this.oApp.registerBrowserEvent(this.aCloseButton[c],"click","HIDE_ACTIVE_LAYER",[]);this.oApp.registerBrowserEvent(this.elDropdownLayer,"click","EVENT_SCHARACTER_CLICKED",[]),this.oApp.exec("REGISTER_UI_EVENT",["sCharacter","click","TOGGLE_SCHARACTER_LAYER"])},$ON_TOGGLE_SCHARACTER_LAYER:function(){this.oTextField.value="",this.oSelection=this.oApp.getSelection(),this.oApp.exec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.elDropdownLayer])},$ON_EVENT_SCHARACTER_CLICKED:function(a){var b=a.target;if("BUTTON"==b.tagName&&"LI"==b.parentNode.tagName){var c=b.firstChild.innerHTML;this.oApp.exec("SELECT_SCHARACTER",[c])}},$ON_SELECT_SCHARACTER:function(a){if(this.oTextField.value+=a,this.oTextField.createTextRange){var b=this.oTextField.createTextRange();b.collapse(!1),b.select()}else this.oTextField.selectionEnd&&(this.oTextField.selectionEnd=this.oTextField.value.length,this.oTextField.focus())},$ON_INSERT_SCHARACTERS:function(){this.oSelection.pasteHTML(this.oTextField.value),this.oApp.exec("HIDE_ACTIVE_LAYER",[])},$ON_CHANGE_SCHARACTER_SET:function(b){for(var c=0;c<this.aSCharList.length;c++)if("block"==this.aSCharList[c].style.display){if(c==b)return;a(this.aLabelA[c]).removeClass("on"),this.aSCharList[c].style.display="none"}this._drawSCharList(b),a(this.aLabelA[b]).addClass("on"),this.aSCharList[b].style.display="block"},$ON_SET_SCHARACTER_LIST:function(a){this.charSet=a,this.bSCharSetDrawn=new Array(this.charSet.length),this._drawSCharList(0)},_drawSCharList:function(a){if(!this.bSCharSetDrawn[a]){this.bSCharSetDrawn[a]=!0;var b=this.charSet[a].length,c=new Array(b);this.aSCharList[a].innerHTML="";for(var d=0;b>d;d++)c[d]=document.createElement("LI"),c[d].innerHTML='<button type="button"><span>'+unescape(this.charSet[a][d])+"</span></button>",this.aSCharList[a].appendChild(c[d])}},_stopBrowserEvent:function(b,c){a(b).bind(c,function(a){a.stopPropagation(),a.preventDefault()})}}),xe.XE_UndoRedo=a.Class({name:"XE_UndoRedo",actionHistory:null,oCurStateIdx:null,iMinimumSizeChange:10,sBlankContentsForFF:"<br>",$init:function(){this.aUndoHistory=[],this.oCurStateIdx={nIdx:0,nStep:0}},$PRECONDITION:function(a){if(a.match(/_DO_RECORD_UNDO_HISTORY_AT$/))return!0;try{if("WYSIWYG"!=this.oApp.getEditingMode())return!1}catch(b){return!1}return!0},$BEFORE_MSG_APP_READY:function(){this.oApp.exec("DO_RECORD_UNDO_HISTORY_AT",[this.oCurStateIdx,"","",null])},$ON_MSG_APP_READY:function(){this.bFF=a.browser.mozilla,this.oApp.exec("ADD_APP_PROPERTY",["getUndoHistory",a.fnBind(this.getUndoHistory,this)]),this.oApp.exec("ADD_APP_PROPERTY",["getUndoStateIdx",a.fnBind(this.getUndoStateIdx,this)]),this.oApp.exec("REGISTER_UI_EVENT",["undo","click","UNDO"]),this.oApp.exec("REGISTER_UI_EVENT",["redo","click","REDO"]),this.oApp.exec("REGISTER_HOTKEY",["ctrl+z","UNDO"]),this.oApp.exec("REGISTER_HOTKEY",["ctrl+y","REDO"])},$ON_UNDO:function(){if(this.oApp.exec("DO_RECORD_UNDO_HISTORY",["KEYPRESS",!1,!1,1]),0!=this.oCurStateIdx.nIdx){if(this.oCurStateIdx.nStep>0)this.oCurStateIdx.nStep--;else{var a=this.aUndoHistory[this.oCurStateIdx.nIdx];this.oCurStateIdx.nIdx--,a.nTotalSteps>1?this.oCurStateIdx.nStep=0:(a=this.aUndoHistory[this.oCurStateIdx.nIdx],this.oCurStateIdx.nStep=a.nTotalSteps-1)}this.oApp.exec("RESTORE_UNDO_HISTORY",[this.oCurStateIdx.nIdx,this.oCurStateIdx.nStep]),this.oApp.exec("CHECK_STYLE_CHANGE",[])}},$ON_REDO:function(){if(!(this.oCurStateIdx.nIdx>=this.aUndoHistory.length)){var a=this.aUndoHistory[this.oCurStateIdx.nIdx];this.oCurStateIdx.nIdx==this.aUndoHistory.length-1&&this.oCurStateIdx.nStep>=a.nTotalSteps-1||(this.oCurStateIdx.nStep<a.nTotalSteps-1?this.oCurStateIdx.nStep++:(this.oCurStateIdx.nIdx++,a=this.aUndoHistory[this.oCurStateIdx.nIdx],this.oCurStateIdx.nStep=a.nTotalSteps-1),this.oApp.exec("RESTORE_UNDO_HISTORY",[this.oCurStateIdx.nIdx,this.oCurStateIdx.nStep]),this.oApp.exec("CHECK_STYLE_CHANGE",[]))}},$ON_RECORD_UNDO_ACTION:function(a){this.oApp.exec("DO_RECORD_UNDO_HISTORY",[a])},$ON_RECORD_UNDO_BEFORE_ACTION:function(a){this.oApp.exec("DO_RECORD_UNDO_HISTORY",[a,!0,!0])},$ON_RECORD_UNDO_AFTER_ACTION:function(a){this.oApp.exec("DO_RECORD_UNDO_HISTORY",[a,!0,!1])},$ON_RESTORE_UNDO_HISTORY:function(a,b){this.oCurStateIdx.nIdx=a,this.oCurStateIdx.nStep=b;var c=this.aUndoHistory[this.oCurStateIdx.nIdx],d=c.sContent[this.oCurStateIdx.nStep],e=c.oBookmark[this.oCurStateIdx.nStep];this.oApp.setIR(d,!0);var f=this.oApp.getIR();this.bFF&&f==this.sBlankContentsForFF&&(f=""),c.sContent[this.oCurStateIdx.nStep]=f;var g=this.oApp.getEmptySelection();g.selectionLoaded&&(e?g.moveToXPathBookmark(e):g=this.oApp.getEmptySelection(),g.select())},$ON_DO_RECORD_UNDO_HISTORY:function(a,b,c,d){b=b||!1,c=c||!1,d=d||0,this.oCurStateIdx.nIdx!=this.aUndoHistory.length-1&&(d=1);var e=this.aUndoHistory[this.oCurStateIdx.nIdx],f=this.oApp.getIR(),g=e.sContent[this.oCurStateIdx.nStep];if(this.bFF&&f==this.sBlankContentsForFF&&(f=""),!b)switch(d){case 0:if(Math.abs(g.length-f.length)<this.iMinimumSizeChange)return;break;case 1:if(g==f)return;break;case 2:}var h=this.oApp.getSelection(),i=null;h.selectionLoaded&&(i=h.getXPathBookmark());var j={nIdx:this.oCurStateIdx.nIdx,nStep:this.oCurStateIdx.nStep};b?c?j.nStep=0:j.nStep=1:j.nStep=0,0==j.nStep&&this.oCurStateIdx.nStep==e.nTotalSteps-1&&(j.nIdx=this.oCurStateIdx.nIdx+1),this.oApp.exec("DO_RECORD_UNDO_HISTORY_AT",[j,a,f,i])},$ON_DO_RECORD_UNDO_HISTORY_AT:function(a,b,c,d){if(0!=a.nStep)this.aUndoHistory[a.nIdx].nTotalSteps=a.nStep+1,this.aUndoHistory[a.nIdx].sContent[a.nStep]=c,this.aUndoHistory[a.nIdx].oBookmark[a.nStep]=d;else{var e={sAction:b,nTotalSteps:1};e.sContent=[],e.sContent[0]=c,e.oBookmark=[],e.oBookmark[0]=d,this.aUndoHistory.splice(a.nIdx,this.aUndoHistory.length-a.nIdx,e)}this.oCurStateIdx.nIdx=a.nIdx,this.oCurStateIdx.nStep=a.nStep},_getUndoHistory:function(){return this.aUndoHistory},_getUndoStateIdx:function(){return this.oCurStateIdx}}),xe.XE_Hyperlink=a.Class({name:"XE_Hyperlink",sATagMarker:"HTTP://HUSKY_TMP.MARKER/",$init:function(a){this._assignHTMLObjects(a),this.sRXATagMarker=this.sATagMarker.replace(/\//g,"\\/").replace(/\./g,"\\.")},_assignHTMLObjects:function(b){this.oHyperlinkLayer=a("DIV.xpress_xeditor_hyperlink_layer",b).get(0),this.oLinkInput=a("INPUT[type=text]",this.oHyperlinkLayer).get(0),this.oBtnConfirm=a("BUTTON.confirm",this.oHyperlinkLayer).get(0),this.oBtnCancel=a("BUTTON.cancel",this.oHyperlinkLayer).get(0),this.oCbNewWin=a("INPUT[type=checkbox]",this.oHyperlinkLayer).get(0)},$ON_MSG_APP_READY:function(){this.oApp.exec("REGISTER_HOTKEY",["ctrl+k","XE_TOGGLE_HYPERLINK_LAYER",[]]),this.oApp.registerBrowserEvent(this.oBtnConfirm,"mousedown","XE_APPLY_HYPERLINK"),this.oApp.registerBrowserEvent(this.oBtnCancel,"mousedown","HIDE_ACTIVE_LAYER"),this.oApp.registerBrowserEvent(this.oLinkInput,"keydown","EVENT_XE_HYPERLINK_KEYDOWN"),this.oApp.exec("REGISTER_UI_EVENT",["hyperlink","click","XE_TOGGLE_HYPERLINK_LAYER"])},$ON_XE_TOGGLE_HYPERLINK_LAYER:function(){this.oApp.delayedExec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.oHyperlinkLayer,null,"XE_RESET_HYPERLINK_LAYER",[]],0)},$ON_XE_RESET_HYPERLINK_LAYER:function(){this.oApp.exec("FOCUS",[]),this.oSelection=this.oApp.getSelection();var a=this.oSelection.findAncestorByTagName("A");if(this.oCbNewWin.checked=!1,a){this.oSelection.selectNode(a),this.oSelection.select();var b=a.target;b&&"_blank"==b&&(this.oCbNewWin.checked=!0),this.oLinkInput.value=a.href?a.href:"http://"}else this.oLinkInput.value="http://";this.oLinkInput.focus(),this.oLinkInput.value=this.oLinkInput.value},$ON_XE_APPLY_HYPERLINK:function(){var b=this.oLinkInput.value,c=this.oCbNewWin.checked,d=c?"_blank":"";if(this.oApp.exec("FOCUS",[]),this.oSelection=this.oApp.getSelection(),this.oSelection.collapsed){var e="<a href='"+b+"' target="+d+">"+b+"</a>";this.oSelection.pasteHTML(e)}else{var f=Math.ceil(1e4*Math.random()),g=this.sATagMarker+f,h=""==b?["unlink"]:["createLink",!1,g+b];this.oApp.exec("EXECCOMMAND",h);try{this.oSelection.setFromSelection()}catch(i){}var j=this.oApp.getWYSIWYGDocument();a(j.body.getElementsByTagName("A")).filter('[href^="'+g+'"]').attr("href",function(){var b=new RegExp("^"+g.replace(/([\.\\])/g,"\\$1"),"i");return d?a(this).attr("target",d):a(this).removeAttr("target"),this.href.replace(b,"")})}this.oApp.exec("HIDE_ACTIVE_LAYER"),setTimeout(a.fnBind(function(){try{this.oSelection.select()}catch(a){}},this),0)},_validateURL:function(a){return/^(http|https|ftp|mailto):(?:\/\/)?((\w|-)+(?:[\.:@](\w|-))+)(?:\/|@)?([^"\?]*?)(?:\?([^\?"]*?))?$/.test(a)},$ON_EVENT_XE_HYPERLINK_KEYDOWN:function(a){13==a.keyCode&&(this.oApp.exec("XE_APPLY_HYPERLINK"),a.preventDefault(),a.stopPropagation())}}),xe.XE_Table=a.Class({name:"XE_Table",iMinRows:1,iMaxRows:20,iMinColumns:1,iMaxColumns:10,iMinBorderWidth:1,iMaxBorderWidth:10,oSelection:null,$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){var c=null;this.elDropdownLayer=a("DIV.xpress_xeditor_table_layer",b).get(0),this.welDropdownLayer=a(this.elDropdownLayer),c=a("INPUT",this.elDropdownLayer).get(),this.oRowInput=c[0],this.oColumnInput=c[1],this.oBorderWidthInput=c[2],this.oBorderColorInput=c[3],this.oBGColorInput=c[4],c=a("BUTTON",this.elDropdownLayer).get(),this.oButton_AddRow=c[0],this.oButton_RemoveRow=c[1],this.oButton_AddColumn=c[2],this.oButton_RemoveColumn=c[3],this.oButton_IncBorderWidth=c[4],this.oButton_DecBorderWidth=c[5],this.oButton_BorderColorPreview=c[6],this.oButton_BorderColor=c[7],this.oButton_BGColorPreview=c[8],this.oButton_BGColor=c[9],this.oButton_Insert=c[10],this.oButton_Cancel=c[11],this.oSampleTable=a("TABLE",this.elDropdownLayer).get(0)},$ON_MSG_APP_READY:function(){this.oApp.exec("REGISTER_UI_EVENT",["table","click","ST_TOGGLE_TOOLBAR_LAYER"]),this.oApp.registerBrowserEvent(this.oRowInput,"change","ST_SET_ROW_NUM",[null,0]),this.oApp.registerBrowserEvent(this.oColumnInput,"change","ST_SET_COLUMN_NUM",[null,0]),this.oApp.registerBrowserEvent(this.oBorderWidthInput,"change","ST_SET_BORDER_WIDTH",[null,0]),this.oApp.registerBrowserEvent(this.oButton_AddRow,"click","ST_ADD_ROW"),this.oApp.registerBrowserEvent(this.oButton_RemoveRow,"click","ST_REMOVE_ROW"),this.oApp.registerBrowserEvent(this.oButton_AddColumn,"click","ST_ADD_COLUMN"),this.oApp.registerBrowserEvent(this.oButton_RemoveColumn,"click","ST_REMOVE_COLUMN"),this.oApp.registerBrowserEvent(this.oButton_IncBorderWidth,"click","ST_INC_BORDER_WIDTH"),this.oApp.registerBrowserEvent(this.oButton_DecBorderWidth,"click","ST_DEC_BORDER_WIDTH"),this.oApp.registerBrowserEvent(this.oButton_BorderColorPreview,"click","ST_TOGGLE_BORDER_COLOR_LAYER"),this.oApp.registerBrowserEvent(this.oButton_BGColorPreview,"click","ST_TOGGLE_BGCOLOR_LAYER"),this.oApp.registerBrowserEvent(this.oButton_BorderColor,"click","ST_TOGGLE_BORDER_COLOR_LAYER"),this.oApp.registerBrowserEvent(this.oButton_BGColor,"click","ST_TOGGLE_BGCOLOR_LAYER"),this.oApp.registerBrowserEvent(this.oButton_Insert,"click","ST_INSERT_TABLE"),this.oApp.registerBrowserEvent(this.oButton_Cancel,"click","ST_CLOSE"),this.oApp.exec("ST_SET_BORDER_COLOR",["#CCCCCC"]),this.oApp.exec("ST_SET_BGCOLOR",["#FFFFFF"])},$ON_ST_TOGGLE_TOOLBAR_LAYER:function(){this.oApp.exec("RECORD_UNDO_ACTION_FORCED",["KEYPRESS"]),this._showNewTable(),this.oApp.exec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.elDropdownLayer])},$ON_ST_ADD_ROW:function(){this.oApp.exec("ST_SET_ROW_NUM",[null,1])},$ON_ST_REMOVE_ROW:function(){this.oApp.exec("ST_SET_ROW_NUM",[null,-1])},$ON_ST_ADD_COLUMN:function(){this.oApp.exec("ST_SET_COLUMN_NUM",[null,1])},$ON_ST_REMOVE_COLUMN:function(){this.oApp.exec("ST_SET_COLUMN_NUM",[null,-1])},$ON_ST_SET_ROW_NUM:function(a,b){a=a||parseInt(this.oRowInput.value),b=b||0,a+=b,a<this.iMinRows&&(a=this.iMinRows),a>this.iMaxRows&&(a=this.iMaxRows),this.oRowInput.value=a,this._showNewTable()},$ON_ST_SET_COLUMN_NUM:function(a,b){a=a||parseInt(this.oColumnInput.value),b=b||0,a+=b,a<this.iMinColumns&&(a=this.iMinColumns),a>this.iMaxColumns&&(a=this.iMaxColumns),this.oColumnInput.value=a,this._showNewTable()},$ON_ST_INSERT_TABLE:function(){var a=this._getTableString();this.oApp.exec("PASTE_HTML",[a]),this.oApp.exec("ST_CLOSE",[])},$ON_ST_CLOSE:function(){this.oApp.exec("HIDE_ACTIVE_LAYER",[])},$ON_ST_SET_BORDER_WIDTH:function(a,b){a=a||parseInt(this.oBorderWidthInput.value),b=b||0,a+=b,a<this.iMinBorderWidth&&(a=this.iMinBorderWidth),a>this.iMaxBorderWidth&&(a=this.iMaxBorderWidth),this.oBorderWidthInput.value=a,this._showNewTable()},$ON_ST_INC_BORDER_WIDTH:function(){this.oApp.exec("ST_SET_BORDER_WIDTH",[null,1])},$ON_ST_DEC_BORDER_WIDTH:function(){this.oApp.exec("ST_SET_BORDER_WIDTH",[null,-1])},$ON_ST_TOGGLE_BORDER_COLOR_LAYER:function(){this.welDropdownLayer.hasClass("p1")?this.oApp.exec("ST_HIDE_BORDER_COLOR_LAYER",[]):this.oApp.exec("ST_SHOW_BORDER_COLOR_LAYER",[])},$ON_ST_SHOW_BORDER_COLOR_LAYER:function(){this.welDropdownLayer.addClass("p1"),this.welDropdownLayer.removeClass("p2"),this.oApp.exec("SHOW_COLOR_PALETTE",["ST_SET_BORDER_COLOR_FROM_PALETTE",this.elDropdownLayer])},$ON_ST_HIDE_BORDER_COLOR_LAYER:function(){this.welDropdownLayer.removeClass("p1"),this.oApp.exec("HIDE_COLOR_PALETTE",[])},$ON_ST_TOGGLE_BGCOLOR_LAYER:function(){this.welDropdownLayer.hasClass("p2")?this.oApp.exec("ST_HIDE_BGCOLOR_LAYER",[]):this.oApp.exec("ST_SHOW_BGCOLOR_LAYER",[])},$ON_ST_SHOW_BGCOLOR_LAYER:function(){this.welDropdownLayer.removeClass("p1"),this.welDropdownLayer.addClass("p2"),this.oApp.exec("SHOW_COLOR_PALETTE",["ST_SET_BGCOLOR_FROM_PALETTE",this.elDropdownLayer])},$ON_ST_HIDE_BGCOLOR_LAYER:function(){this.welDropdownLayer.removeClass("p2"),this.oApp.exec("HIDE_COLOR_PALETTE",[])},$ON_ST_SET_BORDER_COLOR_FROM_PALETTE:function(a){this.oApp.exec("ST_SET_BORDER_COLOR",[a]),this.oApp.exec("ST_HIDE_BORDER_COLOR_LAYER",[])},$ON_ST_SET_BORDER_COLOR:function(a){this.oBorderColorInput.value=a,this.oButton_BorderColorPreview.style.backgroundColor=a,this._showNewTable()},$ON_ST_SET_BGCOLOR_FROM_PALETTE:function(a){this.oApp.exec("ST_SET_BGCOLOR",[a]),this.oApp.exec("ST_HIDE_BGCOLOR_LAYER",[])},$ON_ST_SET_BGCOLOR:function(a){this.oBGColorInput.value=a,this.oButton_BGColorPreview.style.backgroundColor=a,this._showNewTable()},_showNewTable:function(){var a=document.createElement("DIV");a.innerHTML=this._getTableString();var b=a.firstChild;this.oSampleTable.parentNode.insertBefore(b,this.oSampleTable),this.oSampleTable.parentNode.removeChild(this.oSampleTable),this.oSampleTable=b},_getTableString:function(){var b=this.oBorderColorInput.value,c=this.oBGColorInput.value,d=this.oBorderWidthInput.value,e="";e=a.browser.msie?"<td><p></p></td>":a.browser.firefox?"<td><p><br/></p></td>":"<td><p>&nbsp;</p></td>";for(var f='<table style="background:'+b+';border-spacing:1px" cellspacing="'+d+'">',g='<tr style="background:'+c+'">',h=this.oColumnInput.value,i=0;h>i;i++)g+=e;g+="</tr>\n";var j=this.oRowInput.value;f+="<tbody>";for(var i=0;j>i;i++)f+=g;return f+="</tbody>",f+="</table>"}}),xe.XE_EditingModeToggler=a.Class({name:"XE_EditingModeToggler",$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){b=a.$(b)||document,this.elModeToggleButton=a("BUTTON.xpress_xeditor_mode_toggle_button",b).get(0),this.welModeToggleButton=a(this.elModeToggleButton)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elModeToggleButton,"click","EVENT_TOGGLE_EDITING_MODE",[])},$ON_EVENT_TOGGLE_EDITING_MODE:function(){"WYSIWYG"==this.oApp.getEditingMode()?this.oApp.exec("CHANGE_EDITING_MODE",["HTMLSrc"]):this.oApp.exec("CHANGE_EDITING_MODE",["WYSIWYG"]);
},$ON_CHANGE_EDITING_MODE:function(a){"HTMLSrc"==a?(this.welModeToggleButton.addClass("active").parent("span").addClass("active"),this.oApp.exec("DISABLE_ALL_UI",[])):(this.welModeToggleButton.removeClass("active").parent("span").removeClass("active"),this.oApp.exec("ENABLE_ALL_UI",[]))}}),xe.XE_Editorresize=a.Class({name:"XE_Editorresize",$init:function(b,c){this.inputArea=a(".xpress_xeditor_editing_area_container",b).get(0),this.oVerticalResizer=a(".xpress_xeditor_editingArea_verticalResizer",b).get(0),this.oCheckBox=a("#editorresize",b).get(0),this.oIframe=c;var d=this;a(c).load(function(){d.oIframeBody=a(c).contents().find("body")})},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.oCheckBox,"change","XE_TOGGLE_EDITOR_RESIZE")},$ON_XE_TOGGLE_EDITOR_RESIZE:function(){1==this.oCheckBox.checked?(void 0==this._prevHeight&&(this._prevHeight=this.inputArea.style.height),this.oVerticalResizer.style.display="none",this.oApp.registerBrowserEvent(this.oIframeBody,"keydown","XE_EDITOR_RESIZE"),this.inputArea.style.height=this.oIframe.style.height=this.oIframeBody[0].scrollHeight+"px"):(a(this.oIframeBody).unbind("keydown"),this.oVerticalResizer.style.display="block",this.inputArea.style.height=this._prevHeight,this.oIframe.style.height=this._prevHeight)},$ON_XE_EDITOR_RESIZE:function(){var a=this;setTimeout(function(){a.inputArea.style.height=a.oIframe.style.height=a.oIframeBody[0].scrollHeight+"px"},0)}});var d={"XE_EditingAreaManager.onExit":"%uB0B4%uC6A9%uC774%20%uBCC0%uACBD%uB418%uC5C8%uC2B5%uB2C8%uB2E4.","XE_FontColor.invalidColorCode":"%uC0C9%uC0C1%20%uCF54%uB4DC%uB97C%20%uC62C%uBC14%uB974%uAC8C%20%uC785%uB825%uD558%uC5EC%20%uC8FC%uC2DC%uAE30%20%uBC14%uB78D%uB2C8%uB2E4.\n\n%uC608%29%20%23000000%2C%20%23FF0000%2C%20%23FFFFFF%2C%20%23ffffff%2C%20ffffff","XE_BGColor.invalidColorCode":"%uC0C9%uC0C1%20%uCF54%uB4DC%uB97C%20%uC62C%uBC14%uB974%uAC8C%20%uC785%uB825%uD558%uC5EC%20%uC8FC%uC2DC%uAE30%20%uBC14%uB78D%uB2C8%uB2E4.\n\n%uC608%29%20%23000000%2C%20%23FF0000%2C%20%23FFFFFF%2C%20%23ffffff%2C%20ffffff","XE_Hyperlink.invalidURL":"%uC785%uB825%uD558%uC2E0%20URL%uC774%20%uC62C%uBC14%uB974%uC9C0%20%uC54A%uC2B5%uB2C8%uB2E4."};xe.XpressCore.oMessageMap=d;regex_handler=/<(.*?)\s+on[a-z]+\s*=(?:\s*".*?"|\s*'.*?'|[^\s>]+)(.*?)>/gi,regex_font_color=/color\s*=(?:\s*"(.*?)"|\s*'(.*?)'|([^\s>]+))/i,regex_font_face=/face\s*=(?:\s*"(.*?)"|\s*'(.*?)'|([^\s>]+))/i,regex_font_size=/size\s*=(?:\s*"(\d+)"|\s*'(\d+)'|(\d+))/i,regex_style=/style\s*=\s*(?:\s*"(.*?)"|\s*'(.*?)'|([^\s>]+))/i,regex_font_weight=/font-weight\s*:\s*([a-z]+);?/i,regex_font_style=/font-style\s*:\s*italic;?/i,regex_font_decoration=/text-decoration\s*:\s*([a-z -]+);?/i,regex_jquery=/jQuery\d+\s*=(\s*"\d+"|\d+)/gi,regex_quote_attr=/([\w-]+\s*=(?:\s*"[^"]+"|\s*'[^']+'))|([\w-]+)=([^\s]+)/g;var e=("a,abbr,acronym,address,area,blockquote,br,caption,center,cite,code,col,colgroup,dd,del,dfn,div,dl,dt,em,embed,h1,h2,h3,h4,h5,h6,hr,img,ins,kbd,li,map,object,ol,p,param,pre,q,samp,span,strong,sub,sup,table,tbody,td,tfoot,th,thead,tr,tt,u,ul,var,iframe,object,param,style".split(","),"area,br,col,embed,hr,img,input,param,base,meta,link,basefont,isindex".split(",")),f={b:"strong",i:"em",s:"del",strike:"del"};xe.XE_XHTMLFormatter=a.Class({name:"XE_XHTMLFormatter",$ON_MSG_APP_READY:function(){this.oApp.addConverter("WYSIWYG_TO_IR",this.TO_IR),this.oApp.addConverter("HTMLSrc_TO_IR",this.TO_IR),this.oApp.addConverter("IR_TO_HTMLSrc",this.IR_TO),this.oApp.addConverter("IR_TO_WYSIWYG",this.IR_TO)},TO_IR:function(b){var c=[];if(a.browser.msie&&(b=b.replace(regex_jquery,""),b=b.replace(/<(\w+) ([^>]+)>/g,function(a,b,c){return"<"+b+" "+c.replace(regex_quote_attr,function(a,b,c,d){return b?b:/^"/.test(d)||/"$/.test(d)?c+"="+d:c+'="'+(d||c)+'"'})+">"})),regex=/<(\/)?([:\w\/-]+)(.*?)>/gi,b=b.replace(regex,function(b,d,g,h){var i="";if(d=d||"",g=g.toLowerCase(),h=a.trim(h||""),void 0!=f[g]&&(g=f[g]),d){var j=[],k="";if(a.inArray(g,e)>=0)return"";if(!c.length)return"";do k=c.pop(),k.tag==g&&"deleted"!=k.state&&j.push("</"+k.tag+">");while(c.length&&k.tag!=g);return j.join("")}if(a.inArray(g,e)>=0){var l=h.length;return"br"==g&&(h=""),h&&"/"==h.substring(l-1,l)||(h+=" /"),"<"+g+" "+a.trim(h)+">"}return c.push({tag:g,state:i}),"<"+d+g+(h?" "+h:"")+">"}),c.length){var d="";do d=c.pop(),"deleted"!=d.state&&(b+="</"+d.tag+">");while(c.length)}return regex=/<\/p>[ \t]*(\n)?/gi,b=b.replace(regex,"</p>\n")},IR_TO:function(a){return a}}),xe.XE_Extension=a.Class({name:"XE_Extension",seq:"",last_doc:"",$init:function(a,b){this.seq=b,this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elDropdownLayer=a("DIV.xpress_xeditor_extension_layer",b).get(0)},_removeAttrs:function(a){return a},_addEvent:function(){if("WYSIWYG"==this.oApp.getEditingMode()){var b=this.oApp.getWYSIWYGDocument(),c=this.seq,d=function(){var b=a(this),d=b.attr("editor_component");d&&a.isFunction(openComponent)&&(editorPrevNode=b.get(0),openComponent(d,c))};a(b).find("img,div[editor_component]").each(function(){var c=a(this);"IMG"!=this.nodeName||c.attr("editor_component")||c.attr("widget")||c.attr("editor_component","image_link"),this.last_doc!=b&&(c.unbind("dblclick.widget").bind("dblclick.widget",d),this.last_doc=b)})}},$ON_MSG_APP_READY:function(){var b=this.oApp;b.exec("REGISTER_UI_EVENT",["extension","click","TOGGLE_EXTENSION_LAYER"]);var c=function(){b.exec("HIDE_ACTIVE_LAYER",[])};a("a",this.elDropdownLayer).each(function(){var b=a(this);b.attr("component_onclick_event_added")||(b.click(c),b.attr("component_onclick_event_added","Y"))})},$ON_TOGGLE_EXTENSION_LAYER:function(){this.oApp.exec("TOGGLE_TOOLBAR_ACTIVE_LAYER",[this.elDropdownLayer])},$ON_CHANGE_EDITING_MODE:function(a){var b=this;setTimeout(function(){b._addEvent()},100)},$ON_PASTE_HTML:function(){var a=this;setTimeout(function(){a._addEvent()},100)},$ON_LOAD_IR_FIELD:function(){var a=this;setTimeout(function(){a._addEvent()},100)},$ON_SET_IR:function(){var a=this;setTimeout(function(){a._addEvent()},100)}}),xe.XE_AutoSave=a.Class({name:"XE_AutoSave",form:null,textarea:null,$init:function(a,b){this.form=a.form,this.textarea=a,this._assignHTMLObjects(b)},_assignHTMLObjects:function(b){this.welMessageBox=a("autosave_message")},$ON_MSG_APP_READY:function(){var b=a(this.form._saved_doc_title),c=a(this.form._saved_doc_content),d=a(this.form._saved_doc_document_srl),e=a.trim(b.val()),f=a.trim(c.val()),g=a.trim(d.val());(e||f||g)&&(confirm(this.form._saved_doc_message.value)?(a(this.form.title).val(e),this.oApp.setIR(f),"function"==typeof editorGetAutoSavedDoc&&editorGetAutoSavedDoc(this.form)):editorRemoveSavedDoc()),editorEnableAutoSave(this.form,a(this.form).attr("editor_sequence")),this.oApp.exec("REGISTER_HOTKEY",["ctrl+shift+s","AUTO_SAVE"])},$ON_AUTO_SAVE:function(){_editorAutoSave()}}),xe.XE_FormatWithSelectUI=a.Class({name:"XE_FormatWithSelectUI",$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(b){this.elFormatSelect=a("SELECT.xpress_xeditor_ui_format_select",b).get(0)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elFormatSelect,"change","SET_FORMAT_FROM_SELECT_UI"),this.elFormatSelect.selectedIndex=0},$ON_MSG_STYLE_CHANGED:function(b,c){var d=this.oApp.getWYSIWYGDocument().queryCommandValue("FormatBlock");return d?(a.browser.msie&&/([0-9])/.test(d)&&(d="h"+RegExp.$1),this.elFormatSelect.value=d.toLowerCase(),this.elFormatSelect.selectedIndex<0&&(this.elFormatSelect.selectedIndex=0),void(this.elFormatSelect.value!=d.toLowerCase()&&(this.elFormatSelect.selectedIndex=0))):this.elFormatSelect.selectedIndex=0},$ON_SET_FORMAT_FROM_SELECT_UI:function(){var b=this.elFormatSelect.value;b&&(a.browser.msie&&(b="<"+b+">"),this.oApp.exec("EXECCOMMAND",["FormatBlock",!1,b]),this.oApp.exec("CHECK_STYLE_CHANGE",[]))}}),xe.XE_Table=a.Class({_startSel:null,_endSel:null,$ON_MSG_APP_READY:function(){this._doc=a(this.oApp.getWYSIWYGDocument()),this.$FnMouseDown=a.fnBind(this._mousedown,this),this.$FnMouseUp=a.fnBind(this._mouseup,this),this.$FnMouseMove=a.fnBind(this._mousemove,this),this._doc.mousedown(this.$FnMouseDown),this._startSel=null,this._endSel=null,this.oApp.exec("REGISTER_UI_EVENT",["merge_cells","click","MERGE_CELLS"]),this.oApp.exec("REGISTER_UI_EVENT",["split_col","click","CELL_SPLIT_BY_COL"]),this.oApp.exec("REGISTER_UI_EVENT",["split_row","click","CELL_SPLIT_BY_ROW"]),this.oApp.exec("REGISTER_HOTKEY",["ctrl+alt+m","MERGE_CELLS"]),this.$super.$ON_MSG_APP_READY()},$ON_MERGE_CELLS:function(){var b="",c=a(".xe_selected_cell",this.oApp.getWYSIWYGDocument()).filter("td,th"),d=this;if(c.length){this.oApp.exec("RECORD_UNDO_ACTION",["Cell:Merge"]),c.each(function(){b+=a(this).html()}).eq(0).html(b);var e=0;c.eq(0).nextAll("td,th").addBack().filter(".xe_selected_cell").each(function(a){e+=d._getSpan(this,"col")});var f=(this._getRect(c.eq(0)),c.eq(0).parent("tr")),g=c.eq(c.length-1).parent("tr"),h=c.parents("table").eq(0).find("tr"),i=h.index(g.get(0))-h.index(f.get(0))+this._getSpan(c.eq(c.length-1),"row");c.eq(0).attr("colSpan",e).attr("rowSpan",i),c.slice(1).remove()}},$ON_CELL_SPLIT_BY_ROW:function(b){var c=a(".xe_selected_cell",this.oApp.getWYSIWYGDocument()).filter("td,th"),d=c.parents("table").eq(0),e=this;if(c.length){this.oApp.exec("RECORD_UNDO_ACTION",["Cell:Split By Row"]);var f=this._getRect(c.eq(0)).top,g=this._getRect(c.eq(c.length-1)).bottom;(c=d.find("td,th").filter(function(){var b=e._getRect(a(this));return!(b.bottom<=f||b.top>=g)})).filter(".xe_selected_cell").each(function(){var b=a(this),d=b.parent("tr"),f=e._getSpan(b,"row"),g=e._getRect(b),h=[],i=b.clone().html("<br />"),j=1,k=1;f>1?(j=Math.ceil(f/2),k=f-j,h.push(function(){b.attr("rowSpan",j)}),i.attr("rowSpan",k)):(c.filter(function(){if(b.get(0)==this)return!1;var c=a(this),d=e._getRect(c);return!(d.bottom<=g.top||d.top>=g.bottom)}).each(function(){var b=a(this),c=e._getSpan(b,"row")+1;h.push(function(){b.attr("rowSpan",c)})}),a.browser.msie?d.after(d.clone().empty().get(0).outerHTML):d.after(d.clone().empty()));var l=d.nextAll("tr");if(l.length){var m=l.eq(j-1).children("td,th").filter(function(){return e._getRect(a(this)).left>g.left});a.browser.msie?m.length?m.eq(0).before(i.get(0).outerHTML):l.eq(j-1).append(i.get(0).outerHTML):m.length?m.slice(0,1).before(i):l.slice(j-1,1).append(i)}else d.after(d.clone().empty().append(i));a.each(h,function(){this()})})}},$ON_CELL_SPLIT_BY_COL:function(b){var c=a(".xe_selected_cell",this.oApp.getWYSIWYGDocument()).filter("td,th"),d=c.parents("table").slice(0,1),e=this;(new Date).getTime();if(c.length){this.oApp.exec("RECORD_UNDO_ACTION",["Cell:Split By Column"]);var f=c.eq(0).parent("tr"),g=this._getRect(f.find(".xe_selected_cell:first")).left,h=this._getRect(f.find(".xe_selected_cell:last")).right;(c=d.find("td,th").filter(function(){var b=e._getRect(a(this));return!(b.right<=g||b.left>=h)})).filter(".xe_selected_cell").each(function(b){var d=a(this),f=e._getSpan(d,"col"),g=d.clone().html("<br />");if(f>1){var h=Math.ceil(f/2),i=f-h;d.attr("colSpan",h),g.attr("colSpan",i)}else{var j=e._getRect(d);c.filter(function(){if(d.get(0)==this)return!1;var b=a(this),c=e._getRect(b);return!(c.right<=j.left||c.left>=j.right)}).each(function(){var b=a(this);b.attr("colSpan",e._getSpan(b,"col")+1)}),g.attr("colSpan",1)}a.browser.msie?d.after(g.get(0).outerHTML):d.after(g)})}},$ON_CHECK_STYLE_CHANGE:function(){var b=["merge_cells","split_col","split_row"],c=this.oApp,d=this._startSel&&this._startSel.is(".xe_selected_cell")?"ENABLE_UI":"DISABLE_UI";a.each(b,function(){c.exec(d,[this])})},_mousedown:function(b){function c(){return e=f.getSelection().cloneRange(),e.collapseToStart(),e=a(e.startContainer).parents().addBack().filter("td,th").eq(0),e.length?(g._getRect(g._startSel=e),g._doc.bind("mousemove",g.$FnMouseMove),void g._doc.bind("mouseup",g.$FnMouseUp)):g._removeAllListener()||!0}var d=a(b.target),e=d.parents().addBack().filter("td,th,table"),f=this.oApp,g=this;a("td.xe_selected_cell",this.oApp.getWYSIWYGDocument()).removeClass("xe_selected_cell"),this._startSel=null,this._endSel=null,e.length&&this._isLeftClicked(b.button)&&setTimeout(c,0)},_mouseup:function(a){this._removeAllListener(),this._startSel=this._endSel=null},_mousemove:function(b){function c(){var a=f.oApp.getSelection();f._startSel&&(f._startSel.get(0).firstChild||f._startSel.text(" "),a.selectNode(f._startSel.get(0).firstChild),a.collapseToStart(),a.select())}var d=a(b.target),e=d.parents().addBack().filter("td,th").eq(0),f=this;if(e.length&&this._isLeftClicked(b.button)&&(this._endSel||e.get(0)!=this._startSel.get(0))&&(!this._endSel||e.get(0)!=this._endSel.get(0))){this._getRect(this._endSel=e);var g=Math.min(this._startSel.rect.top,this._endSel.rect.top),h=Math.min(this._startSel.rect.left,this._endSel.rect.left),i=Math.max(this._startSel.rect.bottom,this._endSel.rect.bottom),j=Math.max(this._startSel.rect.right,this._endSel.rect.right),k=e.parents("table"),l=k.find("td,th").removeClass("xe_selected_cell"),m=a();do m.each(function(){var b=f._getRect(a(this));b.right>j&&(j=b.right),b.left<h&&(h=b.left),b.top<g&&(g=b.top),b.bottom>i&&(i=b.bottom)}),l=l.filter(":not(.xe_selected_cell)"),m=l.filter(function(){var b=f._getRect(a(this));return!(b.right<=h||b.left>=j||b.bottom<=g||b.top>=i)}).addClass("xe_selected_cell");while(m.length);return a.browser.mozilla||setTimeout(c,0),!1}},_removeAllListener:function(){this._doc.unbind("mousemove",this.$FnMouseMove),this._doc.unbind("mouseup",this.$FnMouseUp)},_isLeftClicked:function(b){return a.browser.msie?!!(1&b):0==b},_getRect:function(a){var b=a.get(0);return a.rect={},a.rect.top=b.offsetTop,a.rect.left=b.offsetLeft,a.rect.bottom=a.rect.top+b.offsetHeight,a.rect.right=a.rect.left+b.offsetWidth,a.rect},_getSpan:function(b,c){var d=parseInt(a(b).attr(c+"span"));return isNaN(d)?1:d}}).extend(xe.XE_Table)}(jQuery),window.xe||(xe={}),xe.Editors=[],xe.XE_GET_WYSYWYG_MODE=jQuery.Class({name:"XE_GET_WYSYWYG_MODE",$init:function(a){this.editor_sequence=a},$ON_CHANGE_EDITING_MODE:function(a){editorMode[this.editor_sequence]="HTMLSrc"==a?"html":"wysiwyg"}}),xe.XE_PreservTemplate=jQuery.Class({name:"XE_PreservTemplate",isRun:!1,$BEFORE_SET_IR:function(a){return this.isRun||a?void 0:(this.isRun=!0,!1)}}),xe.XE_Preview=jQuery.Class({name:"XE_Preview",elPreviewButton:null,$init:function(a){this._assignHTMLObjects(a)},_assignHTMLObjects:function(a){this.elPreviewButton=jQuery("BUTTON.xpress_xeditor_preview_button",a)},$ON_MSG_APP_READY:function(){this.oApp.registerBrowserEvent(this.elPreviewButton.get(0),"click","EVENT_PREVIEW",[])},$ON_EVENT_PREVIEW:function(){}});