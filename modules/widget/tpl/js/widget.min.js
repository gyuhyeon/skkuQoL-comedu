function getStyle(a){var b=a.getAttribute("style");return b||(b=a.style),"object"==typeof b&&(b=b.cssText),b=b.replace(/\burl\s*\(\s*"(.*?)"\s*\)/i,"url('$1')")}function getFloat(a){return jQuery(a).css("float")}function setFloat(a,b){jQuery(a).css("float",b)}function getPadding(a,b){var c=a.getAttribute("widget_padding_"+b);return c&&null!==c||(c=0),c}function doStartPageModify(a,b){zonePageObj=get_by_id(a),zoneModuleSrl=b,jQuery("#tmpPageSizeLayer").appendTo("body").hide().attr("id","pageSizeLayer").css({position:"fixed"}).before('<div class="x_modal-backdrop" />').find(">form").submit(function(){return doApplyWidgetSize(this),!1}),jQuery("#zonePageContent").on("click",doCheckWidget).on("mousedown",doCheckWidgetDrag).on("mouseover",widgetSetup)}function removeAllWidget(){confirm(confirm_delete_msg)&&(restoreWidgetButtons(),jQuery(zonePageObj).html(""))}function getWidgetContent(a){var b="";"undefined"!=typeof a&&a||(a=zonePageObj);var c=null;return jQuery("div.widgetOutput",a).each(function(){if(jQuery(this).parent().get(0)==a)switch(c=jQuery(this).attr("widget")){case"widgetBox":b+=getWidgetBoxCode(this,c);break;case"widgetContent":b+=getContentWidgetCode(this,c);break;default:b+=getWidgetCode(this,c)}}),b}function getContentWidgetCode(a,b){var c,d=(a.firstChild,jQuery("div.widgetContent",a)),e="",f="",g=0,h="contenteditable,id,style,src,widget,body,class,widget_width,widget_width_type,xdpx,xdpy,height,document_srl,widget_padding_left,widget_padding_right,widget_padding_top,widget_padding_bottom,hascontent";if(d.size()>0){g=jQuery(a).attr("document_srl"),e=g>0?"":d.html();for(var i,j=new RegExp("^("+h.replace(/,/g,"|")+")$","i"),k=0;k<a.attributes.length;k++)(c=a.attributes[k].nodeName)&&a.attributes[k].nodeValue&&(j.test(c)||(i=a.attributes[k].nodeValue)&&(f+=c+'="'+encodeURIComponent(i)+'" '));return'<img hasContent="true" class="zbxe_widget_output" widget="widgetContent" style="'+getStyle(a)+'" body="'+e+'" document_srl="'+g+'" widget_padding_left="'+getPadding(a,"left")+'" widget_padding_right="'+getPadding(a,"right")+'" widget_padding_top="'+getPadding(a,"top")+'" widget_padding_bottom="'+getPadding(a,"bottom")+'" '+f+" />"}return""}function getWidgetBoxCode(a,b){for(var c="",d=0;d<a.attributes.length;d++)if(a.attributes[d].nodeName&&a.attributes[d].nodeValue&&!/^jquery[0-9]+/i.test(a.attributes[d].nodeName)){var e=a.attributes[d].nodeName.toLowerCase();if("widget_padding_left"!=e&&"widget_padding_right"!=e&&"widget_padding_top"!=e&&"widget_padding_bottom"!=e&&"contenteditable"!=e&&"id"!=e&&"style"!=e&&"src"!=e&&"widget"!=e&&"body"!=e&&"class"!=e&&"widget_width"!=e&&"widget_width_type"!=e&&"xdpx"!=e&&"xdpy"!=e&&"height"!=e){var f=a.attributes[d].nodeValue;f&&"Array"!=f&&(c+=e+'="'+encodeURIComponent(f)+'" ')}}var g;jQuery(".widget_inner",a).size()>0?(g=jQuery(".widget_inner",a),g=g.get(0)):g=jQuery(".nullWidget",a).get(0);var h=getWidgetContent(g);return'<div widget="widgetBox" style="'+getStyle(a)+'" widget_padding_left="'+getPadding(a,"left")+'" widget_padding_right="'+getPadding(a,"right")+'" widget_padding_top="'+getPadding(a,"top")+'" widget_padding_bottom="'+getPadding(a,"bottom")+'" '+c+"><div><div>"+h+"</div></div></div>"}function getWidgetCode(a,b){for(var c="",d=0;d<a.attributes.length;d++)if(a.attributes[d].nodeName&&a.attributes[d].nodeValue&&!/^jquery[0-9]+/i.test(a.attributes[d].nodeName)){var e=a.attributes[d].nodeName.toLowerCase();if("contenteditable"!=e&&"id"!=e&&"style"!=e&&"src"!=e&&"widget"!=e&&"body"!=e&&"class"!=e&&"widget_width"!=e&&"widget_width_type"!=e&&"xdpx"!=e&&"xdpy"!=e&&"height"!=e){var f=a.attributes[d].nodeValue;f&&"Array"!=f&&"null"!=f&&(c+=e+'="'+encodeURIComponent(f)+'" ')}}a.getAttribute("style");return'<img class="zbxe_widget_output" style="'+getStyle(a)+'" widget="'+b+'" '+c+" />"}function doAddContent(a){var b=request_uri.setQuery("module","widget").setQuery("act","dispWidgetAdminAddContent").setQuery("module_srl",zoneModuleSrl).setQuery("mid",a);popopen(b,"addContent")}function doSyncPageContent(){if(opener&&opener.selectedWidget){var a=get_by_id("content_fo"),b=opener.selectedWidget;a.style.value=getStyle(opener.selectedWidget),a.widget_padding_left.value=getPadding(b,"left"),a.widget_padding_right.value=getPadding(b,"right"),a.widget_padding_bottom.value=getPadding(b,"bottom"),a.widget_padding_top.value=getPadding(b,"top");for(var c=b.firstChild;c&&!jQuery(c).hasClass("widgetContent");)c=c.nextSibling;if(c&&jQuery(c).hasClass("widgetContent")&&(!a.document_srl||"0"==a.document_srl.value))try{var d=Base64.decode(xInnerHtml(c));d=editorReplacePath(d),get_by_id("content_fo").content.value=d,xe.Editors[1].exec("SET_IR",[d])}catch(e){}}"undefined"!=typeof editorStart&&editorStart(1,"module_srl","content",!1,400)}function addContentWidget(a){var b=a.getAttribute("editor_sequence"),c=(a.mid.value,a.module_srl.value),d=a.document_srl.value,e=editorGetContent(b),f={editor_sequence:b,content:e,module_srl:c,document_srl:d};if(/^\s*<p>.*<\/p>\s*$/i.test(f.content)){var g=f.content.toLowerCase(),h=g.indexOf("</p>"),i=g.lastIndexOf("</p>");h>0&&i>0&&h==i&&(f.content=e=f.content.replace(/^\s*<p>|<\/p>\s*$/gi,""))}return exec_xml("widget","procWidgetInsertDocument",f,function(b,c){if(b&&"0"==b.error){var d=b.document_srl,f=opener.jQuery("div.widgetOutput[widget=widgetContent][document_srl="+d+"]"),g=[];f.size()>0&&(g=f.get(0).attributes);for(var h='<div class="widgetOutput" style="'+a.style.value+'" widget_padding_left="'+a.widget_padding_left.value+'" widget_padding_right="'+a.widget_padding_right.value+'" widget_padding_top="'+a.widget_padding_top.value+'" widget_padding_bottom="'+a.widget_padding_bottom.value+'" document_srl="'+d+'" widget="widgetContent"><button type="button" class="widgetResize"></button><button type="button" class="widgetResizeLeft"></button><div class="widgetBorder"><div style="padding:'+a.widget_padding_top.value+"px "+a.widget_padding_right.value+"px "+a.widget_padding_bottom.value+"px "+a.widget_padding_left.value+'px"></div>'+e+'</div><div class="widgetContent" style="display:none;width:1px;height:1px;overflow:hidden;"></div></div>',i=jQuery(h),j=0,k=g.length;k>j;j++)i.attr(g[j].name)||i.attr(g[j].name,g[j].value);h=jQuery("<div>").append(i).html(),opener.doAddWidgetCode(h),window.close()}},"document_srl".split(",")),!1}function doAddWidgetBox(){var a='<div class="widgetOutput" style="float:left;width:100%;height:20px;" widget="widgetBox" ><button type="button" class="widgetBoxResize"></button><button type="button" class="widgetBoxResizeLeft"></button><div class="widgetBoxBorder"><div class="nullWidget" style="width:100%;height:100px;"></div></div></div>';zonePageObj.innerHTML+=a}function doAddWidget(a){var b=a.widget_list,c=b.selectedIndex,d=b.options[c].value,e=a.module_srl.value,f=request_uri.setQuery("module","widget").setQuery("act","dispWidgetGenerateCodeInPage").setQuery("selected_widget",d).setQuery("module_srl",e);popopen(f,"GenerateWidgetCode")}function doAddWidgetCode(widget_code){restoreWidgetButtons();for(var tmp=widget_code;tmp.indexOf("<!--#Meta:")>-1;){var pos=tmp.indexOf("<!--#Meta:");tmp=tmp.substr(pos);var eos=tmp.indexOf("-->"),cssfile=tmp.substr(10,eos-10);if(cssfile.indexOf(".js")>-1)tmp=tmp.substr(eos);else{if(!cssfile)break;if(tmp=tmp.substr(eos),cssfile=request_uri+cssfile,"undefined"==typeof document.createStyleSheet){var css='<link rel="stylesheet" href="'+cssfile+'" />',dummy=xCreateElement("DIV");xInnerHtml(dummy,css),document.body.appendChild(dummy)}else document.createStyleSheet(cssfile,0)}}for(checkDocumentWrite=!0,tmp=widget_code.toLowerCase();tmp.indexOf("<script")>-1;){var pos=tmp.indexOf("<script");tmp=tmp.substr(pos);var length=tmp.indexOf("</script>")+9,script=widget_code.substr(pos,length);script=script.replace(/^<script([^>]*)>/i,"").replace(/<\/script>$/i,""),writedText=null;try{eval(script)}catch(e){}widget_code=widget_code.substr(0,pos)+writedText+widget_code.substr(pos+length),tmp=widget_code.toLowerCase()}var dummy=xCreateElement("div");xInnerHtml(dummy,widget_code);var obj=dummy.childNodes[0];if(selectedWidget&&selectedWidget.getAttribute("widget")){var o=jQuery("div.widget_inner",selectedWidget),n=jQuery("div.widget_inner",obj);0===n.size()&&(n=jQuery("div.nullWidget",obj)),0===o.size()&&(o=jQuery("div.nullWidget",selectedWidget)),n.html(o.html()),selectedWidget.parentNode.insertBefore(obj,selectedWidget),selectedWidget.parentNode.removeChild(selectedWidget)}else get_by_id("zonePageContent").appendChild(obj);checkDocumentWrite=!1,selectedWidget=null}function doCheckWidget(a){if(a.target){var b=a.target,c=jQuery(b);if(selectedWidget=null,doHideWidgetSizeSetup(),c.hasClass("widgetSetup")){var d=b.parentNode.parentNode,e=d.getAttribute("widget"),f=d.getAttribute("widgetstyle");if(!e)return;return selectedWidget=d,void("widgetContent"==e?popopen(request_uri+"?module=widget&act=dispWidgetAdminAddContent&module_srl="+zoneModuleSrl+"&document_srl="+d.getAttribute("document_srl"),"addContent"):popopen(request_uri+"?module=widget&act=dispWidgetGenerateCodeInPage&selected_widget="+e+"&widgetstyle="+f,"GenerateCodeInPage"))}if(c.hasClass("widgetStyle")){var d=b.parentNode.parentNode,e=d.getAttribute("widget"),f=d.getAttribute("widgetstyle");if(!e)return;return selectedWidget=d,void popopen(request_uri+"?module=widget&act=dispWidgetStyleGenerateCodeInPage&selected_widget="+e+"&widgetstyle="+f,"GenerateCodeInPage")}if(c.hasClass("widgetCopy")&&jQuery(b.parentNode.parentNode).hasClass("widgetOutput")){var d=b.parentNode.parentNode;if(restoreWidgetButtons(),"widgetContent"==d.getAttribute("widget")&&d.getAttribute("document_srl")){var g=["error","message","document_srl"],h=[];return h.document_srl=d.getAttribute("document_srl"),void exec_xml("widget","procWidgetCopyDocument",h,completeCopyWidgetContent,g,h,d)}var i=xCreateElement("DIV");xInnerHtml(i,xInnerHtml(d)),i.widget_sequence="",i.className="widgetOutput";for(var j=0;j<d.attributes.length;j++)if(d.attributes[j].nodeName&&d.attributes[j].nodeValue){var k=d.attributes[j].nodeName.toLowerCase(),l=d.attributes[j].nodeValue;l&&(l&&"string"==typeof l&&(l=l.replace(/\"/gi,"&quot;")),i.setAttribute(k,l))}return xIE4Up&&(i.style.cssText=d.style.cssText),void d.parentNode.insertBefore(i,d)}if(c.hasClass("widgetSize")||c.hasClass("widgetBoxSize")){var d=b.parentNode.parentNode,e=d.getAttribute("widget");if(!e)return;return selectedWidget=d,void doShowWidgetSizeSetup(a.pageX,a.pageY,selectedWidget)}if(c.hasClass("widgetRemove")||c.hasClass("widgetBoxRemove")){var d=b.parentNode.parentNode,e=d.getAttribute("widget");return void(confirm(confirm_delete_msg)&&(restoreWidgetButtons(),d.parentNode.removeChild(d)))}for(var d=b;d;){if(jQuery(d).hasClass("widgetOutput")){a.cancelBubble=!0,a.returnValue=!1,a.preventDefault(),a.stopPropagation();break}d=d.parentNode}}}function completeCopyWidgetContent(a,b,c,d){var e=a.document_srl,f=xCreateElement("DIV");xInnerHtml(f,xInnerHtml(d)),f.widget_sequence="",f.className="widgetOutput";for(var g=0;g<d.attributes.length;g++)if(d.attributes[g].nodeName&&d.attributes[g].nodeValue){var h=d.attributes[g].nodeName.toLowerCase(),i=d.attributes[g].nodeValue;i&&(i&&"string"==typeof i&&(i=i.replace(/\"/gi,"&quot;")),f.setAttribute(h,i))}d.setAttribute("document_srl",e),xIE4Up&&(f.style.cssText=d.getAttribute("style").cssText),d.parentNode.insertBefore(f,d)}function completeDeleteWidgetContent(a,b,c,d){restoreWidgetButtons(),d.parentNode.removeChild(d)}function doCheckWidgetDrag(a){if(a.target){var b=a.target,c=jQuery(b);if(!(c.parents("#pageSizeLayer").size()>0||(doHideWidgetSizeSetup(),c.hasClass("widgetSetup")||c.hasClass("widgetStyle")||c.hasClass("widgetCopy")||c.hasClass("widgetBoxCopy")||c.hasClass("widgetSize")||c.hasClass("widgetBoxSize")||c.hasClass("widgetRemove")||c.hasClass("widgetBoxRemove"))))for(p_obj=b;p_obj;){var d=jQuery(p_obj);if(d.hasClass("widgetOutput")||d.hasClass("widgetResize")||d.hasClass("widgetResizeLeft")||d.hasClass("widgetBoxResize")||d.hasClass("widgetBoxResizeLeft"))return widgetDragEnable(p_obj,widgetDragStart,widgetDrag,widgetDragEnd),void widgetMouseDown(a);p_obj=p_obj.parentNode}}}function _getInt(a){return a&&"null"!=a?isNaN(parseInt(a,10))?0:parseInt(a,10):0}function doShowWidgetSizeSetup(a,b,c){var d=jQuery("#pageSizeLayer"),e=d.find(">form:first"),f=jQuery(c);if(e.length){selectedSizeWidget=c;var g=jQuery(selectedSizeWidget),h={widget_align:f.css("float"),css_class:g.attr("css_class")?g.attr("css_class"):"",width:f[0].style.width,height:f[0].style.height,padding_left:_getInt(f.attr("widget_padding_left")),padding_right:_getInt(f.attr("widget_padding_right")),padding_top:_getInt(f.attr("widget_padding_top")),padding_bottom:_getInt(f.attr("widget_padding_bottom")),margin_left:_getInt(f.css("marginLeft")),margin_right:_getInt(f.css("marginRight")),margin_top:_getInt(f.css("marginTop")),margin_bottom:_getInt(f.css("marginBottom")),border_top_color:transRGB2Hex(f.css("borderTopColor")),border_top_thick:f.css("borderTopWidth").replace(/px$/i,""),border_top_type:f.css("borderTopStyle"),border_bottom_color:transRGB2Hex(f.css("borderBottomColor")),border_bottom_thick:f.css("borderBottomWidth").replace(/px$/i,""),border_bottom_type:f.css("borderBottomStyle"),border_right_color:transRGB2Hex(f.css("borderRightColor")),border_right_thick:f.css("borderRightWidth").replace(/px$/i,""),border_right_type:f.css("borderRightStyle"),border_left_color:transRGB2Hex(f.css("borderLeftColor")),border_left_thick:f.css("borderLeftWidth").replace(/px$/i,""),border_left_type:f.css("borderLeftStyle"),background_color:transRGB2Hex(f.css("backgroundColor")),background_image_url:f.css("backgroundImage").replace(/^url\(/i,"").replace(/\)$/i,""),background_x:0,background_y:0,background_repeat:f.css("backgroundRepeat")},i=f.css("backgroundPosition");i&&(i=i.split(" "),2==i.length&&(h.background_x=i[0],h.background_y=i[1])),d.show(),jQuery(function(a){var b=a("#pageSizeLayer"),c=a(".x_modal-backdrop"),d=a(window).width(),e=a(window).height(),f=b.width(),g=b.height();d>f&&e>g?(c.show(),b.css({position:"fixed",top:e/2-g/2+"px",left:d/2-f/2+"px",width:"700px"})):(c.hide(),b.css({position:"static",top:"auto",left:"auto",width:"auto"}))}),jQuery.each(h,function(a,b){var c=e[0].elements[a],d=jQuery(c);c&&(d.val(b),d.hasClass("color-indicator")&&"transparent"!=b&&(b=b.toUpperCase(),d.css("background","#"+b),d.val("#"+b))),"select"==c.tagName.toLowerCase()&&-1==c.selectedIndex&&(c.selectedIndex=0)});try{e[0].elements[0].focus()}catch(j){}}}function doHideWidgetSizeSetup(){jQuery("#pageSizeLayer, .x_modal-backdrop, .jPicker.Container").hide()}function _getSize(a){if(!a)return 0;var b="px";a.lastIndexOf("%")>=0&&(b="%");var c=parseInt(a,10);return 1>c?0:("%"==b&&c>100&&(c=100),""+c+b)}function _getBorderStyle(a,b,c){var d=a.value;d=d.replace(/^#/,""),d=d?"#"+d:"#FFFFFF";var e=b.value;e=e?parseInt(e,10)+"px":"0px";var f=c.options[c.selectedIndex].value;f||(f="solid");var g=d+" "+e+" "+f;return g}function _getBGColorStyle(a){var b=a.replace(/^#/,"");return b=b?"#"+b:"#FFFFFF"}function doApplyWidgetSize(a){if(selectedSizeWidget){1==a.widget_align.selectedIndex?setFloat(selectedSizeWidget,"right"):setFloat(selectedSizeWidget,"left");var b=jQuery(a),c=jQuery(selectedSizeWidget),d=b.find("#css_class").val();d&&c.attr("css_class",d);var e=_getSize(a.width.value);e&&(selectedSizeWidget.style.width=e);var f=_getSize(a.height.value);if(f&&"100%"!=f)selectedSizeWidget.style.height=f;else{selectedSizeWidget.style.height="";for(var g=xGetElementsByClassName("widgetBorder",selectedSizeWidget),h=0;h<g.length;h++){var i=g[h];i.style.height=""}}selectedSizeWidget.style.borderTop=_getBorderStyle(a.border_top_color,a.border_top_thick,a.border_top_type),selectedSizeWidget.style.borderBottom=_getBorderStyle(a.border_bottom_color,a.border_bottom_thick,a.border_bottom_type),selectedSizeWidget.style.borderLeft=_getBorderStyle(a.border_left_color,a.border_left_thick,a.border_left_type),selectedSizeWidget.style.borderRight=_getBorderStyle(a.border_right_color,a.border_right_thick,a.border_right_type),selectedSizeWidget.style.marginTop=_getSize(a.margin_top.value),selectedSizeWidget.style.marginRight=_getSize(a.margin_right.value),selectedSizeWidget.style.marginBottom=_getSize(a.margin_bottom.value),selectedSizeWidget.style.marginLeft=_getSize(a.margin_left.value),a.background_color.value&&"#"!=a.background_color.value&&"transparent"!=a.background_color.value?selectedSizeWidget.style.backgroundColor=_getBGColorStyle(a.background_color.value):selectedSizeWidget.style.backgroundColor="transparent";var j=a.background_image_url.value;switch(j&&"none"!=j?selectedSizeWidget.style.backgroundImage="url("+j+")":selectedSizeWidget.style.backgroundImage="none",a.background_repeat.selectedIndex){case 1:selectedSizeWidget.style.backgroundRepeat="no-repeat";break;case 2:selectedSizeWidget.style.backgroundRepeat="repeat-x";break;case 3:selectedSizeWidget.style.backgroundRepeat="repeat-y";break;default:selectedSizeWidget.style.backgroundRepeat="repeat"}selectedSizeWidget.style.backgroundPosition=a.background_x.value+" "+a.background_y.value;for(var k=selectedSizeWidget.firstChild;k;){var l=jQuery(k);if("DIV"==k.nodeName&&(l.hasClass("widgetBorder")||l.hasClass("widgetBoxBorder"))){for(var m=k.firstChild;m;){if("DIV"==m.nodeName){m.style.padding="";var n=_getSize(a.padding_left.value);n?(m.style.paddingLeft=n,selectedSizeWidget.setAttribute("widget_padding_left",n)):(m.style.paddingLeft="",selectedSizeWidget.setAttribute("widget_padding_left",""));var o=_getSize(a.padding_right.value);o?(m.style.paddingRight=o,selectedSizeWidget.setAttribute("widget_padding_right",o)):(m.style.paddingRight="",selectedSizeWidget.setAttribute("widget_padding_right",""));var p=_getSize(a.padding_top.value);p?(m.style.paddingTop=p,selectedSizeWidget.setAttribute("widget_padding_top",p)):(m.style.paddingTop="",selectedSizeWidget.setAttribute("widget_padding_top",""));var q=_getSize(a.padding_bottom.value);q?(m.style.paddingBottom=q,selectedSizeWidget.setAttribute("widget_padding_bottom",q)):(m.style.paddingBottom="",selectedSizeWidget.setAttribute("widget_padding_bottom",""));break}m=m.nextSibling}break}k=k.nextSibling}selectedWidget=selectedSizeWidget,selectedSizeWidget=null;for(var r=selectedWidget.getAttribute("widget"),s=[],h=0;h<selectedWidget.attributes.length;h++)if(selectedWidget.attributes[h].nodeName&&selectedWidget.attributes[h].nodeValue){var t=selectedWidget.attributes[h].nodeName.toLowerCase();if("contenteditable"!=t&&"id"!=t&&"src"!=t&&"widget"!=t&&"body"!=t&&"class"!=t&&"widget_width"!=t&&"widget_width_type"!=t&&"xdpx"!=t&&"xdpy"!=t&&"height"!=t){var u=selectedWidget.attributes[h].nodeValue;u&&"Array"!=u&&(s[t]=u)}}s.style=getStyle(selectedWidget),s.selected_widget=r,s.module_srl=get_by_id("pageFo").module_srl.value,exec_xml("widget","procWidgetGenerateCodeInPage",s,function(a){doAddWidgetCode(a.widget_code)},["error","message","widget_code","tpl","css_header"])}doHideWidgetSizeSetup()}function restoreWidgetButtons(){var a=get_by_id("widgetButton"),b=get_by_id("widgetBoxButton");if(a&&b){a.style.visibility="hidden",get_by_id("zonePageContent").parentNode.appendChild(a),b.style.visibility="hidden",get_by_id("zonePageContent").parentNode.appendChild(b);for(var c=0;c<hideElements.length;c++){var d=hideElements[0];d.style.paddingTop=0}hideElements=[]}}function showWidgetButton(a,b){var c=get_by_id(a);c&&(c.style.visibility="visible",b.insertBefore(c,b.firstChild))}function widgetSetup(a){var b=a.target;if(!(jQuery(b).is(".widgetButtons")||jQuery(b).parents(".widgetButtons").size()>0||jQuery(b).is(".buttonBox")||jQuery(b).parents(".buttonBox").size()>0)){var c=jQuery(b).parents(".widgetOutput");if(0===c.size())return void restoreWidgetButtons();b=c.get(0);var d=c.attr("widget");if(d)if("widgetBox"==d)restoreWidgetButtons(),showWidgetButton("widgetBoxButton",b);else{restoreWidgetButtons(),showWidgetButton("widgetButton",b);var e=b.parentNode;if(e)for(;e;){if("DIV"==e.nodeName&&"widgetBox"==e.getAttribute("widget")){showWidgetButton("widgetBoxButton",e);break}e=e.parentNode}}}}function widgetCreateTmpObject(a){var b=a.getAttribute("id");return tmpObj=xCreateElement("DIV"),tmpObj.id=b+"_tmp",tmpObj.className=a.className,tmpObj.style.overflow="hidden",tmpObj.style.margin="0px",tmpObj.style.padding="0px",tmpObj.style.width=a.style.width,tmpObj.style.display="none",tmpObj.style.position="absolute",tmpObj.style.opacity=1,tmpObj.style.filter="alpha(opacity=100)",xLeft(tmpObj,xPageX(a)),xTop(tmpObj,xPageY(a)),document.body.appendChild(tmpObj),widgetTmpObject[a.id]=tmpObj,tmpObj}function widgetGetTmpObject(a){a.id||(a.id="widget_"+idStep++);var b=widgetTmpObject[a.id];return b||(b=widgetCreateTmpObject(a)),b}function widgetDragEnable(a,b,c,d){a.draggable=!0,a.dragStart=b,a.drag=c,a.dragEnd=d,widgetDragManager.isDrag||(widgetDragManager.isDrag=!0,jQuery(document).on("mousemove",widgetDragMouseMove))}function widgetDragStart(a,b,c){var d=jQuery(a);if(!(d.hasClass("widgetResize")||d.hasClass("widgetResizeLeft")||d.hasClass("widgetBoxResize")||d.hasClass("widgetBoxResizeLeft"))){var e=widgetGetTmpObject(a);xInnerHtml(e,xInnerHtml(a)),xLeft(e,xPageX(a)),xTop(e,xPageY(a)),xWidth(e,xWidth(a)),xHeight(e,xHeight(a)),xDisplay(e,"block")}}function widgetDrag(a,b,c){var d=jQuery(a),e=40,f=10,g=xPageX(a.parentNode),h=xPageY(a.parentNode),i=a.xDPX,j=a.xDPY,k=xWidth(zonePageObj),l=xPageX(zonePageObj),m=l+k,n=xWidth(a.parentNode),o=getFloat(a.parentNode);if(o||(o="left"),d.hasClass("widgetResize")||d.hasClass("widgetBoxResize")){g+e>i&&(i=g+e),i>m&&(i=m),"right"==o&&(i=g+n);var p=i-g;e>p&&(p=e);var q=j-h;f>q&&(q=f),g+p>m&&(p=m-g),xWidth(a.parentNode,p),xHeight(a.parentNode,q)}else if(d.hasClass("widgetResizeLeft")||d.hasClass("widgetBoxResizeLeft")){l>i&&(i=l),"left"==o&&(i=g);var p=n+(g-i);e>p&&(p=e);var q=j-h;f>q&&(q=f),xWidth(a.parentNode,p),xHeight(a.parentNode,q)}else{var r=widgetGetTmpObject(a);if(xLeft(r,parseInt(xPageX(r),10)+parseInt(b,10)),xTop(r,parseInt(xPageY(r),10)+parseInt(c,10)),a.parentNode!=zonePageObj){for(var s=xGetElementsByClassName("widgetOutput",a.parentNode),t=0;t<s.length;t++){var u=s[t],v=xPageX(u),w=xPageY(u),x=parseInt(v,10)+parseInt(xWidth(u),10),y=parseInt(w,10)+parseInt(xHeight(u),10);if(a!=u&&a.xDPX>=v&&a.xDPX<=x&&a.xDPY>=w&&a.xDPY<=y&&a.parentNode==u.parentNode){var z=u.nextSibling;z||(z=xCreateElement("DIV"),u.parentNode.appendChild(z));var A=a.nextSibling;return A||(A=xCreateElement("DIV"),a.parentNode.appendChild(A)),z&&z.parentNode.insertBefore(a,z),A&&A.parentNode.insertBefore(u,A),void(s=null)}}s=null;var B=jQuery(a).parents("div.nullWidget").get(0),v=xPageX(B),w=xPageY(B),x=parseInt(v,10)+parseInt(xWidth(B),10),y=parseInt(w,10)+parseInt(xHeight(B),10);if(a.xDPX<v||a.xDPX>x||a.xDPY<w||a.xDPY>y)return void zonePageObj.insertBefore(a,jQuery(a).parents("div.widgetOutput[widget=widgetBox]").get(0))}else{if("widgetBox"!=a.getAttribute("widget")){for(var C=xGetElementsByClassName("nullWidget",zonePageObj),t=0;t<C.length;t++){var u=C[t],D=jQuery(u);xHeight(u,xHeight(u.parentNode)),xWidth(u,xWidth(u.parentNode));var v=xPageX(u),w=xPageY(u),x=parseInt(v,10)+parseInt(xWidth(u),10),y=parseInt(w,10)+parseInt(xHeight(u),10);if(a.xDPX>=v&&a.xDPX<=x&&a.xDPY>=w&&a.xDPY<=y&&D.hasClass("nullWidget")){var E=jQuery("div.widget_inner",D);return 0===E.size()?u.appendChild(a):E.get(0).appendChild(a),widgetManualEnd(),void(C=null)}}C=null}for(var s=xGetElementsByClassName("widgetOutput",zonePageObj),t=0;t<s.length;t++){var u=s[t],F=u.getAttribute("widget");if("widgetBox"!=F&&u.parentNode==zonePageObj){var v=xPageX(u),w=xPageY(u),x=parseInt(v,10)+parseInt(xWidth(u),10),y=parseInt(w,10)+parseInt(xHeight(u),10);if(a!=u&&a.xDPX>=v&&a.xDPX<=x&&a.xDPY>=w&&a.xDPY<=y&&a.parentNode==u.parentNode){var z=u.nextSibling;z||(z=u.parentNode.lastChild),z||(z=xCreateElement("DIV"),u.parentNode.appendChild(z));var A=a.nextSibling;return A||(A=xCreateElement("DIV"),a.parentNode.appendChild(A)),z&&z.parentNode.insertBefore(a,z),A&&A.parentNode.insertBefore(u,A),void(s=null)}}}s=null}}}function widgetDragEnd(a,b,c){var d=widgetGetTmpObject(a);widgetDisapear=widgetDisapearObject(d,a),widgetDragDisable(a.getAttribute("id"))}function widgetDisapearObject(a,b){xInnerHtml(b,xInnerHtml(a)),xInnerHtml(a,""),jQuery(a).hide(),a.parentNode.removeChild(a),widgetTmpObject[b.id]=null}function widgetMouseDown(a){for(var b=a.target;b&&!b.draggable;)b=xParent(b,!0);b&&(a.preventDefault(),b.xDPX=a.pageX,b.xDPY=a.pageY,widgetDragManager.obj=b,jQuery(document).on("mouseup",widgetMouseUp),b.dragStart&&b.dragStart(b,a.pageX,a.pageY))}function widgetMouseUp(a){widgetDragManager.obj&&(a.preventDefault(),jQuery(document).off("mouseup",widgetMouseUp),widgetDragManager.obj.dragEnd&&widgetDragManager.obj.dragEnd(widgetDragManager.obj,a.pageX,a.pageY),widgetDragManager.obj=null,widgetDragManager.isDrag=!1)}function widgetDragMouseMove(a){if(widgetDragManager.obj){a.preventDefault();var b=widgetDragManager.obj,c=a.pageX-b.xDPX,d=a.pageY-b.xDPY;b.xDPX=a.pageX,b.xDPY=a.pageY,b.drag?b.drag(b,c,d):xMoveTo(b,xLeft(b)+c,xTop(b)+d)}}function widgetDragDisable(a){if(widgetDragManager){var b=get_by_id(a);b.draggable=!1,b.dragStart=null,b.drag=null,b.dragEnd=null,jQuery(b).off("mousedown",widgetMouseDown)}}function widgetManualEnd(){var a=widgetDragManager.obj;if(a){jQuery(document).off("mouseup",widgetMouseUp),jQuery(document).on("mousemove",widgetDragMouseMove);var b=widgetGetTmpObject(a);widgetDisapear=widgetDisapearObject(b,a),widgetDragDisable(a.getAttribute("id")),widgetDragManager.obj=null,widgetDragManager.isDrag=!1}}var zonePageObj=null,zoneModuleSrl=0,selectedWidget=null,writedText=null,checkDocumentWrite=!1;window.document.write=window.document.writeln=function(a){if(checkDocumentWrite)return void(writedText=a);if(!a.match(/^<\//)){window.opera||(a=a.replace(/&(?![#a-z0-9]+;)/g,"&")),a=a.replace(/(<[a-z]+)/g,"$1 xmlns='http://www.w3.org/1999/xhtml'");var b,c=jQuery("<div>").html(a)[0];b=document.getElementsByTagName("*"),b=b[b.length-1];for(var d=c.childNodes;d.length;)b.parentNode.appendChild(d[0])}};var selectedSizeWidget=null;jQuery(function(a){a(document).keydown(function(b){var c=a(".jPicker.Container:visible");return 27!=b.which||c.length?27==b.which&&c.length?(c.hide(),!1):!0:(doHideWidgetSizeSetup(),!1)})});var hideElements=[],widgetDragManager={obj:null,isDrag:!1},widgetTmpObject=[],widgetDisappear=0,idStep=0;